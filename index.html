<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFVT Team Followup - Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; margin: 0; padding: 20px; padding-bottom: 100px; }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a202c; display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .login-box { background: white; padding: 30px; border-radius: 12px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; display: none; }
        
        .header-section { text-align: center; margin-bottom: 25px; }
        .team-logo { max-width: 100px; height: auto; border-radius: 10px; margin-bottom: 15px; border: 1px solid #ddd; }
        
        .luxury-gold-title {
            font-family: 'Playfair Display', serif;
            font-size: 46px;
            font-weight: 900;
            margin: 0;
            text-transform: uppercase;
            display: inline-block;
            letter-spacing: 2px;
            position: relative;
            background: linear-gradient(to bottom, #bf953f 0%, #fcf6ba 20%, #b38728 45%, #fcf6ba 55%, #bf953f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            filter: drop-shadow(0px 0px 1px #947a39) drop-shadow(0px 0px 8px rgba(212, 175, 55, 0.6));
            animation: lightSweep 4s infinite linear;
        }

        @keyframes lightSweep {
            0% { background-position: -100% center; }
            100% { background-position: 100% center; }
        }

        .branding-bar { display: flex; justify-content: space-between; align-items: center; background: #fff1f2; padding: 12px; border-radius: 12px; margin-bottom: 20px; border: 1.5px solid #ec4899; }
        .leader-card-inline { display: flex; align-items: center; gap: 10px; }
        .profile-circle-small { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #ec4899; overflow: hidden; background: #fff; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .profile-circle-small img { width: 100%; height: 100%; object-fit: cover; object-position: center top; }
        .leader-info-small { display: flex; flex-direction: column; }
        .leader-name-small { font-weight: 700; font-size: 15px; margin: 0; color: #1e293b; }
        .leader-rank-small { font-size: 8px; color: #be185d; font-weight: 800; text-transform: uppercase; margin: 1px 0; letter-spacing: 0.2px; }
        .team-tag { font-size: 9px; color: #1e293b; font-weight: 700; background: #fce7f3; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 2px; border: 1px solid #f9a8d4; }
        .contact-btn-small { color: #ec4899; text-decoration: none; font-size: 11px; font-weight: 700; display: flex; align-items: center; gap: 5px; margin-top: 3px; }
        .ig-icon { width: 14px; height: 14px; }
        .inline-logo { width: 65px; height: auto; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); flex-shrink: 0; }

        .form-section { background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 25px; }
        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .input-group label { display: block; font-size: 11px; font-weight: 700; color: #718096; margin-bottom: 5px; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e0; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        .add-btn { background: #2563eb; color: white; border: none; padding: 11px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; align-self: flex-end; }
        .high-pv { background-color: #dcfce7 !important; border-left: 5px solid #16a34a; } 
        .no-consistency { background-color: #fee2e2 !important; border-left: 5px solid #ef4444; } 
        .achiever-row { background-color: #fffbeb !important; border-left: 5px solid #f59e0b; } 
        .status-red { color: #dc2626 !important; font-weight: 800; background-color: #fef2f2; padding: 2px 6px; border-radius: 4px; }
        .action-bar { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 15px; flex-wrap: wrap; }
        #searchInput { flex-grow: 1; border: 1px solid #cbd5e0; border-radius: 6px; padding: 10px; min-width: 200px; }
        .btn-group { display: flex; gap: 8px; }
        .btn-success { background: #059669; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .btn-danger { background: #e11d48; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .btn-restore { background: #64748b; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th { background: #f1f5f9; padding: 14px; text-align: left; font-size: 11px; font-weight: 700; color: #475569; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        td { padding: 14px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .wa-link { color: #25D366; text-decoration: none; font-weight: 700; border: 1px solid #25D366; padding: 5px 8px; border-radius: 5px; font-size: 11px; white-space: nowrap;}
        .delete-btn { color: #94a3b8; cursor: pointer; border: none; background: none; font-size: 16px; }
        #trashSection { display: none; background: #fff1f2; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px dashed #fda4af; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <img src="https://i.postimg.cc/9rn4BN6W/NFVT-Logo.jpg" style="width: 80px; margin-bottom: 15px; border-radius: 8px;">
        <h2 style="margin: 0 0 15px 0; font-size: 18px;">Team Followup Login</h2>
        <input type="number" id="loginId" placeholder="Distributor ID">
        <input type="password" id="loginPass" placeholder="Password">
        <button onclick="checkLogin()" style="background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 10px;">Login</button>
        <p id="errorMsg" style="color: red; font-size: 12px; display: none; margin-top: 10px;">ID அல்லது Password தவறு!</p>
    </div>
</div>

<div class="container" id="mainApp">
    <div class="header-section">
        <img src="https://i.postimg.cc/9rn4BN6W/NFVT-Logo.jpg" alt="NFVT Logo" class="team-logo">
        <br>
        <h1 class="luxury-gold-title">NFVT Team Followup</h1>
    </div>

    <div class="branding-bar">
        <div class="leader-card-inline">
            <div class="profile-circle-small">
                <img src="https://i.postimg.cc/LhqXwQ9Y/Leader.jpg" alt="Girish S">
            </div>
            <div class="leader-info-small">
                <p class="leader-name-small">Girish S</p>
                <span class="leader-rank-small">Universal Crown Director of Vestige</span>
                <span class="team-tag">DUCD Saravanan Team</span>
                <a href="https://www.instagram.com/girish_business/#" target="_blank" class="contact-btn-small">
                    <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" class="ig-icon" alt="Instagram">
                    Contact
                </a>
            </div>
        </div>
        <img src="https://i.postimg.cc/PNWQDG2x/New-Logo.jpg" alt="Team Branding" class="inline-logo">
    </div>

    <div class="form-section">
        <div class="grid-form">
            <div class="input-group"><label>Member Name</label><input type="text" id="downlineName"></div>
            <div class="input-group"><label>Distributor ID</label><input type="number" id="distId" oninput="if(this.value.length > 8) this.value = this.value.slice(0, 8);" placeholder="8 Digit ID"></div>
            <div class="input-group">
                <label>Level</label>
                <select id="memberLevel">
                    <option value="Distributor">Distributor</option>
                    <option value="Senior Distributor">Senior Distributor</option>
                    <option value="Assistant Bronze Director">Assistant Bronze Director</option>
                    <option value="Bronze Director">Bronze Director</option>
                    <option value="Silver Director">Silver Director</option>
                    <option value="Gold Director">Gold Director</option>
                    <option value="Star Director">Star Director</option>
                    <option value="Diamond Director">Diamond Director</option>
                    <option value="Crown Director">Crown Director</option>
                    <option value="UCD">UCD</option>
                    <option value="DCD">DCD</option>
                    <option value="DUCD">DUCD</option>
                </select>
            </div>
            <div class="input-group"><label>Self PV</label><input type="number" id="selfPV"></div>
            <div class="input-group"><label>Date</label><input type="date" id="followUpDate"></div>
            <div class="input-group"><label>100PV Consistency</label><select id="consistency"><option value="Yes">Yes</option><option value="No">No</option></select></div>
            <div class="input-group"><label>8% Achiever?</label><select id="achiever"><option value="No">No</option><option value="Yes">Yes</option></select></div>
            <div class="input-group"><label>Meeting Attended?</label><select id="meeting"><option value="Yes">Yes</option><option value="No">No</option></select></div>
            <button class="add-btn" onclick="addData()">Add Member</button>
        </div>
    </div>

    <div id="trashSection">
        <h3 style="font-size: 14px; margin: 0 0 10px 0; color: #be185d;">♻️ Deleted Members</h3>
        <table style="background: transparent;">
            <thead><tr><th>Name</th><th>Action</th></tr></thead>
            <tbody id="trashBody"></tbody>
        </table>
        <button onclick="toggleTrash()" style="margin-top: 10px; font-size: 11px; cursor: pointer; padding: 5px 10px;">Close Trash</button>
    </div>

    <div class="action-bar">
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="பெயர் அல்லது ID தேடுக...">
        <div class="btn-group">
            <button class="btn-success" onclick="downloadCSV()">Excel</button>
            <button class="btn-danger" onclick="downloadPDF()">PDF</button>
            <button class="btn-restore" onclick="toggleTrash()">Restore/Trash</button>
        </div>
    </div>

    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr><th>Distributor & ID</th><th>Level</th><th>PV</th><th>Date</th><th>100PV</th><th>8%</th><th>Meeting</th><th>Action</th><th>WhatsApp</th></tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    function checkLogin() {
        const id = document.getElementById('loginId').value;
        const pass = document.getElementById('loginPass').value;
        if(id.length === 8 && pass === "nfvt") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            displayData();
        } else {
            document.getElementById('errorMsg').style.display = 'block';
        }
    }

    window.onload = function() { 
        document.getElementById('followUpDate').value = new Date().toISOString().split('T')[0];
    };

    function addData() {
        const name = document.getElementById('downlineName').value;
        const distId = document.getElementById('distId').value;
        const level = document.getElementById('memberLevel').value;
        const pv = parseFloat(document.getElementById('selfPV').value) || 0;
        const rawDate = document.getElementById('followUpDate').value;
        const consistency = document.getElementById('consistency').value;
        const achiever = document.getElementById('achiever').value;
        const meeting = document.getElementById('meeting').value;

        if (!name || distId.length !== 8) { alert("ID 8 எண்கள் இருக்க வேண்டும்!"); return; }

        const entry = { name, distId, level, pv, rawDate, consistency, achiever, meeting, id: Date.now() };
        let entries = JSON.parse(localStorage.getItem('nfvt_ucd_final')) || [];
        entries.unshift(entry); 
        localStorage.setItem('nfvt_ucd_final', JSON.stringify(entries));
        displayData();
        
        // Clear inputs
        document.getElementById('downlineName').value = '';
        document.getElementById('distId').value = '';
        document.getElementById('selfPV').value = '';
    }

    function displayData() {
        const tableBody = document.getElementById('tableBody');
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_final')) || [];
        tableBody.innerHTML = '';
        entries.forEach(item => {
            let rowClass = item.consistency === "No" ? 'class="no-consistency"' : (item.pv >= 100 ? 'class="high-pv"' : (item.achiever === 'Yes' ? 'class="achiever-row"' : ''));
            const pvStyle = item.pv < 30 ? 'class="status-red"' : '';
            const waLink = `https://wa.me/?text=வணக்கம் ${item.name}, PV: ${item.pv} - Team NFVT`;
            
            tableBody.innerHTML += `
                <tr ${rowClass}>
                    <td><strong>${item.name}</strong><br><small>${item.distId}</small></td>
                    <td>${item.level}</td>
                    <td ${pvStyle}>${item.pv} PV</td>
                    <td>${item.rawDate}</td>
                    <td>${item.consistency}</td>
                    <td>${item.achiever}</td>
                    <td>${item.meeting}</td>
                    <td><button class="delete-btn" onclick="deleteEntry(${item.id})">❌</button></td>
                    <td><a href="${waLink}" target="_blank" class="wa-link">WhatsApp</a></td>
                </tr>`;
        });
    }

    function deleteEntry(id) {
        if(confirm("நிச்சயமாக நீக்க வேண்டுமா?")) {
            let entries = JSON.parse(localStorage.getItem('nfvt_ucd_final')) || [];
            let trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
            
            const itemIndex = entries.findIndex(e => e.id === id);
            if (itemIndex > -1) {
                trash.push(entries[itemIndex]);
                entries.splice(itemIndex, 1);
                
                localStorage.setItem('nfvt_ucd_final', JSON.stringify(entries));
                localStorage.setItem('nfvt_trash', JSON.stringify(trash));
                
                displayData();
                if(document.getElementById('trashSection').style.display === 'block') {
                    updateTrashUI();
                }
            }
        }
    }

    function toggleTrash() {
        const ts = document.getElementById('trashSection');
        if (ts.style.display === 'none' || ts.style.display === '') {
            ts.style.display = 'block';
            updateTrashUI();
        } else {
            ts.style.display = 'none';
        }
    }

    function updateTrashUI() {
        const trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
        const trashBody = document.getElementById('trashBody');
        trashBody.innerHTML = trash.map(i => `
            <tr>
                <td>${i.name} (${i.distId})</td>
                <td><button onclick="restoreEntry(${i.id})" style="background:#2563eb; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;">Restore</button></td>
            </tr>`).join('');
    }

    function restoreEntry(id) {
        let entries = JSON.parse(localStorage.getItem('nfvt_ucd_final')) || [];
        let trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
        
        const itemIndex = trash.findIndex(e => e.id === id);
        if (itemIndex > -1) {
            entries.unshift(trash[itemIndex]);
            trash.splice(itemIndex, 1);
            
            localStorage.setItem('nfvt_ucd_final', JSON.stringify(entries));
            localStorage.setItem('nfvt_trash', JSON.stringify(trash));
            
            displayData();
            updateTrashUI();
        }
    }

    function filterTable() {
        const q = document.getElementById("searchInput").value.toUpperCase();
        const r = document.getElementById("tableBody").getElementsByTagName("tr");
        for (let row of r) { row.style.display = row.innerText.toUpperCase().includes(q) ? "" : "none"; }
    }

    function downloadCSV() {
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_final')) || [];
        if(entries.length === 0) return;
        let csv = "Name,ID,Level,PV,Date,100PV,8%Achiever,Meeting\n";
        entries.forEach(e => csv += `"${e.name}","${e.distId}","${e.level}","${e.pv}","${e.rawDate}","${e.consistency}","${e.achiever}","${e.meeting}"\n`);
        const b = new Blob([csv], {type:'text/csv'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download="NFVT_Report.csv"; a.click();
    }

    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("NFVT Team Followup Report", 14, 15);
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_final')) || [];
        const rows = entries.map(e => [e.name, e.distId, e.level, e.pv, e.rawDate]);
        doc.autoTable({
            head: [['Name', 'ID', 'Level', 'PV', 'Date']],
            body: rows,
            startY: 20
        });
        doc.save("NFVT_Report.pdf");
    }
</script>
</body>
</html>
