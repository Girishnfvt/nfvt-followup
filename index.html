
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFVT Team Followup - Enhanced Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); 
            min-height: 100vh; margin: 0; padding: 20px; 
            animation: gradientShift 15s ease infinite;
            background-size: 400% 400%;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #loginOverlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%); 
            display: flex; align-items: center; justify-content: center; z-index: 2000; 
        }
        .login-box { 
            background: white; padding: 35px; border-radius: 20px; text-align: center; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 320px;
            animation: fadeInScale 0.5s ease-out;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .container { 
            max-width: 1400px; margin: auto; background: white; padding: 30px; 
            border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); 
            position: relative; display: none;
            animation: slideIn 0.6s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-profile-bar { 
            display: flex; align-items: center; justify-content: space-between; 
            background: linear-gradient(135deg, #bf953f 0%, #fcf6ba 25%, #b38728 50%, #fcf6ba 75%, #bf953f 100%); 
            background-size: 300% auto;
            animation: goldBarSweep 4s linear infinite;
            padding: 15px 25px; border-radius: 15px; margin-bottom: 25px; 
            box-shadow: 0 8px 30px rgba(180,130,0,0.5), 0 0 0 2px rgba(255,215,0,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
            border: 1px solid rgba(255,215,0,0.6);
            position: relative;
            overflow: hidden;
        }
        .user-profile-bar::before {
            content: '';
            position: absolute; inset: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.15) 50%, transparent 100%);
            animation: shimmerBar 3s ease-in-out infinite;
        }
        @keyframes goldBarSweep {
            0% { background-position: 0% center; }
            100% { background-position: 300% center; }
        }
        @keyframes shimmerBar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(200%); }
        }
        .user-details { display: flex; align-items: center; gap: 15px; position: relative; z-index: 1; }
        .user-avatar { 
            width: 50px; height: 50px; 
            background: linear-gradient(135deg, #1a1040 0%, #0f0c29 100%); 
            color: #ffd700; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; font-weight: 900; font-size: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4), 0 0 0 3px rgba(255,215,0,0.5);
            border: 2px solid rgba(255,215,0,0.8);
        }
        .user-details div { color: #1a1040; }
        .user-details div:first-child { font-size: 16px; font-weight: 800; color: #1a1040; text-shadow: 0 1px 2px rgba(255,255,255,0.3); }
        .user-details div:last-child { font-size: 12px; opacity: 0.7; color: #2d1a00; }
        .language-toggle {
            background: rgba(0,0,0,0.15);
            border: 2px solid rgba(0,0,0,0.3);
            color: #1a1040;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 800;
            transition: all 0.3s ease;
            margin-left: 10px;
            position: relative; z-index: 1;
        }
        .language-toggle:hover { background: rgba(0,0,0,0.25); }
        .logout-btn {
            background: rgba(0,0,0,0.15);
            border: 2px solid rgba(0,0,0,0.3);
            color: #1a1040;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 800;
            transition: all 0.3s ease;
            position: relative; z-index: 1;
        }
        .logout-btn:hover { background: rgba(0,0,0,0.25); }

        .stats-summary { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            padding: 20px; border-radius: 15px; font-weight: 800; color: white; 
            margin-bottom: 25px; text-align: center; font-size: 18px;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .stats-summary.has-alerts {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
            background-size: 200% auto;
            animation: alertPulse 1.5s ease-in-out infinite, alertGlow 1.5s ease-in-out infinite;
            box-shadow: 0 8px 30px rgba(239,68,68,0.6), 0 0 40px rgba(239,68,68,0.3);
            transform: scale(1.01);
        }
        .stats-summary.has-alerts::before {
            content: 'üîî ACTION NEEDED ';
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            font-size: 13px; font-weight: 900; color: rgba(255,255,255,0.8);
            animation: flashText 1s ease-in-out infinite;
        }
        .stats-summary.has-alerts::after {
            content: '';
            position: absolute; inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
            animation: scanLine 2s linear infinite;
        }
        @keyframes alertPulse {
            0%, 100% { background-position: 0% center; transform: scale(1.01); }
            50% { background-position: 100% center; transform: scale(1.015); }
        }
        @keyframes alertGlow {
            0%, 100% { box-shadow: 0 8px 30px rgba(239,68,68,0.6), 0 0 40px rgba(239,68,68,0.3); }
            50% { box-shadow: 0 8px 50px rgba(239,68,68,0.8), 0 0 80px rgba(239,68,68,0.5); }
        }
        @keyframes flashText { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes scanLine { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }

        .header-section { text-align: center; margin-bottom: 30px; }
        .team-logo { 
            max-width: 120px; height: auto; border-radius: 15px; margin-bottom: 20px; 
            border: 3px solid #fbbf24; box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }
        .luxury-gold-title {
            font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 900; 
            margin: 0; text-transform: uppercase;
            background: linear-gradient(45deg, #bf953f 0%, #fcf6ba 20%, #b38728 45%, #fcf6ba 55%, #bf953f 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            filter: drop-shadow(0px 2px 3px #947a39); 
            animation: lightSweep 3s infinite linear;
            background-size: 200% auto;
        }
        @keyframes lightSweep { 
            0% { background-position: 0% center; } 
            100% { background-position: 200% center; } 
        }
        .form-section { 
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); 
            padding: 25px; border-radius: 15px; border: 2px solid #3b82f6; 
            margin-bottom: 30px; box-shadow: 0 6px 20px rgba(59, 130, 246, 0.2);
        }
        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .input-group label { 
            display: block; font-size: 11px; font-weight: 800; color: #475569; 
            margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;
        }
        input, select { 
            width: 100%; padding: 10px; border: 2px solid #cbd5e0; border-radius: 8px; 
            font-size: 14px; transition: all 0.3s ease;
        }
        input:focus, select:focus { 
            outline: none; border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .add-btn { 
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); 
            color: white; border: none; padding: 12px; border-radius: 8px; 
            font-weight: 700; cursor: pointer; align-self: flex-end;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
            transition: all 0.3s ease;
        }
        .add-btn:hover { transform: translateY(-2px); }
        .edit-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white; border: none; padding: 6px 12px; border-radius: 6px;
            cursor: pointer; font-weight: 700; font-size: 11px; margin-right: 5px;
            transition: all 0.3s ease;
        }
        .edit-btn:hover { transform: scale(1.05); }
        .high-pv { background: linear-gradient(90deg, #d1fae5 0%, #a7f3d0 100%) !important; border-left: 6px solid #10b981; } 
        .low-pv-warning { background: linear-gradient(90deg, #fed7aa 0%, #fdba74 100%) !important; border-left: 6px solid #f97316; }
        .inactive-warning { background: linear-gradient(90deg, #fecaca 0%, #fca5a5 100%) !important; border-left: 6px solid #ef4444; }
        .no-consistency { background: linear-gradient(90deg, #fee2e2 0%, #fecaca 100%) !important; border-left: 6px solid #dc2626; } 
        .no-meeting { background: linear-gradient(90deg, #ddd6fe 0%, #c4b5fd 100%) !important; border-left: 6px solid #8b5cf6; }
        .low-group-pv { background: linear-gradient(90deg, #fef3c7 0%, #fde68a 100%) !important; border-left: 6px solid #f59e0b; }
        .action-bar { display: flex; justify-content: space-between; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        #searchInput { flex-grow: 1; border: 2px solid #cbd5e0; border-radius: 10px; padding: 12px 15px; font-size: 14px; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
        .btn-trash { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
        .btn-settings { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3); }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 15px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        th { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 15px; text-align: left; font-size: 11px; font-weight: 800; color: white; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 15px 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        tr:hover td { background-color: #f8fafc; }
        .wa-link { color: white; text-decoration: none; font-weight: 700; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); padding: 6px 12px; border-radius: 6px; font-size: 11px; box-shadow: 0 3px 10px rgba(37, 211, 102, 0.3); display: inline-block; }
        .delete-btn { color: #ef4444; cursor: pointer; border: none; background: none; font-size: 20px; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 3000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { font-size: 24px; font-weight: 800; color: #1e293b; margin-bottom: 15px; text-align: center; }
        .modal-body { font-size: 16px; line-height: 1.8; color: #334155; margin-bottom: 25px; }
        .modal-btn { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 15px; margin: 5px; }
        .modal-btn-close { background: #64748b; }
        .branding-bar { display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); padding: 15px; border-radius: 15px; margin-top: 40px; border: 2px solid #ec4899; }
        .leader-card-inline { display: flex; align-items: center; gap: 12px; }
        .profile-circle-small { width: 70px; height: 70px; border-radius: 50%; border: 3px solid #ec4899; overflow: hidden; background: #fff; }
        .profile-circle-small img { width: 100%; height: 100%; object-fit: cover; }
        .leader-name-small { font-weight: 800; font-size: 16px; margin: 0; color: #1e293b; }
        .leader-rank-small { font-size: 9px; color: #be185d; font-weight: 800; text-transform: uppercase; }
        .team-tag { font-size: 10px; color: #1e293b; font-weight: 700; background: #fce7f3; padding: 3px 8px; border-radius: 6px; display: inline-block; margin-top: 3px; }
        .inline-logo { width: 75px; height: auto; border-radius: 50%; }

        /* ===== BEST WORKERS BANNER - NEBULA + STARS ===== */
        .best-workers-banner {
            position: relative;
            margin: 0 0 28px 0;
            cursor: pointer;
            border-radius: 20px;
            overflow: hidden;
            background: #060414;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,215,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .best-workers-banner:hover {
            transform: translateY(-4px) scale(1.005);
            box-shadow: 0 25px 70px rgba(0,0,0,0.7), 0 0 60px rgba(255,200,0,0.25);
        }

        /* Nebula background layers */
        .nebula-bg {
            position: absolute; inset: 0; overflow: hidden; pointer-events: none;
        }
        .nebula-bg::before {
            content: '';
            position: absolute; inset: -50%;
            background:
                radial-gradient(ellipse 60% 40% at 20% 50%, rgba(120,40,200,0.45) 0%, transparent 60%),
                radial-gradient(ellipse 50% 60% at 80% 30%, rgba(20,80,200,0.35) 0%, transparent 60%),
                radial-gradient(ellipse 70% 50% at 50% 80%, rgba(180,20,100,0.3) 0%, transparent 60%),
                radial-gradient(ellipse 40% 40% at 70% 60%, rgba(0,150,180,0.25) 0%, transparent 50%);
            animation: nebulaDrift 20s ease-in-out infinite alternate;
        }
        .nebula-bg::after {
            content: '';
            position: absolute; inset: -20%;
            background:
                radial-gradient(ellipse 80% 30% at 30% 20%, rgba(255,100,200,0.15) 0%, transparent 55%),
                radial-gradient(ellipse 60% 40% at 75% 70%, rgba(80,200,255,0.12) 0%, transparent 55%);
            animation: nebulaDrift 28s ease-in-out infinite alternate-reverse;
        }
        @keyframes nebulaDrift {
            0% { transform: translate(0,0) scale(1); }
            33% { transform: translate(2%, 1%) scale(1.03); }
            66% { transform: translate(-1%, 2%) scale(0.98); }
            100% { transform: translate(1%, -1%) scale(1.02); }
        }

        /* Star fields */
        .star-field {
            position: absolute; inset: 0; pointer-events: none;
            background-image:
                radial-gradient(circle, rgba(255,255,255,0.9) 1px, transparent 1px),
                radial-gradient(circle, rgba(255,220,100,0.7) 1px, transparent 1px),
                radial-gradient(circle, rgba(200,200,255,0.6) 1px, transparent 1px),
                radial-gradient(circle, rgba(255,255,255,0.5) 0.5px, transparent 0.5px);
            background-size: 120px 120px, 80px 80px, 60px 60px, 40px 40px;
            background-position: 10px 15px, 40px 60px, 20px 35px, 55px 10px;
            animation: starTwinkle 6s ease-in-out infinite alternate;
        }
        .star-field-2 {
            position: absolute; inset: 0; pointer-events: none;
            background-image:
                radial-gradient(circle, rgba(255,255,255,0.8) 1px, transparent 1px),
                radial-gradient(circle, rgba(180,180,255,0.5) 1px, transparent 1px),
                radial-gradient(circle, rgba(255,240,180,0.4) 0.5px, transparent 0.5px);
            background-size: 90px 90px, 70px 70px, 45px 45px;
            background-position: 30px 50px, 15px 25px, 60px 40px;
            animation: starTwinkle 8s ease-in-out infinite alternate-reverse;
        }
        @keyframes starTwinkle {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.02); }
        }

        /* Gold dust particles */
        .gold-dust {
            position: absolute; inset: 0; overflow: hidden; pointer-events: none;
        }
        .dust-particle {
            position: absolute;
            width: 3px; height: 3px;
            background: radial-gradient(circle, #ffd700, transparent);
            border-radius: 50%;
            animation: dustFloat linear infinite;
            opacity: 0;
        }

        .banner-inner {
            position: relative; z-index: 2;
            display: flex; align-items: center; justify-content: space-between;
            padding: 22px 28px; gap: 20px;
        }
        .banner-title-section {
            text-align: center; flex: 1; min-width: 180px;
        }
        .banner-crown {
            font-size: 36px; line-height: 1; margin-bottom: 4px;
            animation: crownFloat 2.5s ease-in-out infinite;
        }
        @keyframes crownFloat {
            0%, 100% { transform: translateY(0) rotate(-5deg); filter: drop-shadow(0 4px 12px rgba(255,200,0,0.6)); }
            50% { transform: translateY(-6px) rotate(5deg); filter: drop-shadow(0 8px 20px rgba(255,200,0,0.9)); }
        }
        .banner-month-label {
            font-size: 10px; font-weight: 800; letter-spacing: 4px;
            color: rgba(255,200,80,0.7); text-transform: uppercase; margin-bottom: 4px;
        }
        .banner-main-title {
            font-family: 'Playfair Display', serif;
            font-size: 22px; font-weight: 900; line-height: 1.1;
            background: linear-gradient(45deg, #bf953f 0%, #fcf6ba 30%, #b38728 55%, #fcf6ba 75%, #bf953f 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            animation: goldSweep 3s linear infinite;
            filter: drop-shadow(0 2px 8px rgba(180,130,0,0.5));
        }
        @keyframes goldSweep { 0% { background-position: 0%; } 100% { background-position: 200%; } }
        .banner-sub-title {
            font-size: 11px; color: rgba(255,220,120,0.8); font-weight: 600; margin-top: 4px; letter-spacing: 1px;
        }
        .banner-divider {
            width: 1px; height: 90px; background: linear-gradient(to bottom, transparent, rgba(255,200,80,0.5), transparent);
            flex-shrink: 0;
        }
        .banner-worker {
            display: flex; align-items: center; gap: 14px; flex: 1; min-width: 0;
        }
        .banner-worker.right { flex-direction: row-reverse; }
        .banner-worker-photo {
            position: relative; flex-shrink: 0;
        }

        /* ===== MINIMAL RING ‚Äî WRAP = PHOTO SIZE so ring sits on the face border ===== */
        .banner-photo-ring-wrap {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            /* wrap matches photo exactly ‚Äî ring uses negative inset to sit just outside */
            width: 68px;
            height: 68px;
        }
        /* Photo fills the wrap completely */
        .banner-photo-ring-wrap .worker-photo-img {
            width: 68px;
            height: 68px;
            border-radius: 50%;
            object-fit: cover;
            object-position: center top;
            display: block;
            position: relative;
            z-index: 2;
            border: none;
            box-shadow: 0 4px 16px rgba(0,0,0,0.55);
        }
        /* Static gold ring sitting just outside the photo edge */
        .minimal-gold-ring {
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            z-index: 3;
            pointer-events: none;
            border: 2.5px solid rgba(255, 215, 0, 0.85);
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.35);
        }
        .minimal-gold-ring-2 {
            display: none;
        }
        /* Static soft glow behind the ring */
        .ring-glow-pulse {
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.12) 0%, transparent 70%);
            z-index: 0;
            pointer-events: none;
        }

        .banner-badge {
            position: absolute; bottom: -4px; right: -4px;
            width: 22px; height: 22px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px;
            background: transparent;
            z-index: 5;
        }
        .banner-worker-info { min-width: 0; }
        .banner-worker.right .banner-worker-info { text-align: right; }
        .banner-worker-rank {
            font-size: 9px; font-weight: 800; letter-spacing: 2px;
            color: rgba(255,200,80,0.7); text-transform: uppercase; margin-bottom: 2px;
        }
        .banner-worker-name {
            font-size: 16px; font-weight: 800; color: white; margin-bottom: 2px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .banner-worker-title {
            font-size: 10px; color: rgba(255,255,255,0.5);
        }
        .banner-click-hint {
            position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
            font-size: 10px; color: rgba(255,200,80,0.6); font-weight: 600; letter-spacing: 1px;
            animation: hintPulse 2s ease-in-out infinite;
            white-space: nowrap; z-index: 2;
        }
        @keyframes hintPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        /* ===== AWARD MODAL ===== */
        #awardModal {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.85); z-index: 9000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(8px);
        }
        .award-modal-box {
            background: linear-gradient(145deg, #0f0c29 0%, #1a1040 50%, #24243e 100%);
            border: 1px solid rgba(255,200,80,0.3);
            border-radius: 28px; width: 90%; max-width: 700px;
            max-height: 90vh; overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0,0,0,0.7), 0 0 60px rgba(255,180,0,0.15);
            animation: awardAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        @keyframes awardAppear {
            from { opacity: 0; transform: scale(0.7) translateY(40px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .award-confetti-top {
            position: absolute; top: 0; left: 0; right: 0; height: 6px;
            background: linear-gradient(90deg, #bf953f, #fcf6ba, #b38728, #fcf6ba, #bf953f, #fcf6ba, #bf953f);
            background-size: 200% auto;
            animation: goldSweep 2s linear infinite;
            border-radius: 28px 28px 0 0;
        }
        .award-modal-inner { padding: 36px 32px 32px; position: relative; z-index: 1; }
        .award-header { text-align: center; margin-bottom: 28px; }
        .award-header-crown { font-size: 52px; margin-bottom: 8px; animation: crownFloat 2.5s ease-in-out infinite; }
        .award-header-month {
            font-size: 11px; font-weight: 800; letter-spacing: 5px;
            color: rgba(255,200,80,0.7); text-transform: uppercase; margin-bottom: 6px;
        }
        .award-header-title {
            font-family: 'Playfair Display', serif; font-size: 30px; font-weight: 900;
            background: linear-gradient(45deg, #bf953f 0%, #fcf6ba 30%, #b38728 60%, #fcf6ba 80%, #bf953f 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-size: 200% auto; animation: goldSweep 3s linear infinite;
            filter: drop-shadow(0 2px 12px rgba(180,130,0,0.6)); line-height: 1.1;
        }
        .award-header-sub {
            font-size: 13px; color: rgba(255,220,120,0.7); margin-top: 8px; font-weight: 500; letter-spacing: 1px;
        }
        .award-workers-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 28px;
        }
        @media (max-width: 500px) { .award-workers-grid { grid-template-columns: 1fr; } }
        .award-worker-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,200,80,0.2);
            border-radius: 18px; padding: 24px 20px; text-align: center;
            transition: transform 0.3s ease;
            position: relative; overflow: hidden;
        }
        .award-worker-card::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at top, rgba(255,200,80,0.08) 0%, transparent 70%);
            pointer-events: none;
        }
        .award-worker-card:hover { transform: translateY(-4px); border-color: rgba(255,200,80,0.5); }
        .award-worker-card-num {
            position: absolute; top: 14px; left: 14px;
            width: 28px; height: 28px; border-radius: 50%;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000; font-weight: 900; font-size: 13px;
            display: flex; align-items: center; justify-content: center;
        }
        .award-photo-wrap {
            position: relative; display: inline-flex; align-items: center; justify-content: center;
            /* wrap = photo size so ring sits right on the face border */
            width: 92px; height: 92px; margin-bottom: 14px;
        }
        /* Matching minimal ring on award modal */
        .award-photo-wrap .worker-photo-img {
            width: 92px; height: 92px; border-radius: 50%; object-fit: cover;
            object-position: center top;
            position: relative; z-index: 2;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6), 0 0 20px rgba(255,200,0,0.2);
        }
        .award-photo-wrap .minimal-gold-ring {
            inset: -3px; border-width: 2.5px;
        }
        .award-photo-wrap .minimal-gold-ring-2 {
            inset: -7px; border-width: 2px;
        }
        .award-photo-wrap .ring-glow-pulse {
            inset: -10px;
        }
        .award-photo-ring {
            position: absolute; inset: -8px; border-radius: 50%;
            border: 2px solid rgba(255,200,80,0.3);
            animation: ringPulse 2s ease-in-out infinite;
        }
        @keyframes ringPulse { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.08); opacity: 1; } }
        .award-worker-badge-label {
            display: inline-block;
            background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728);
            color: #0f0c29; font-size: 9px; font-weight: 900;
            letter-spacing: 2px; text-transform: uppercase;
            padding: 4px 12px; border-radius: 20px; margin-bottom: 10px;
        }
        .award-worker-name-modal { font-size: 18px; font-weight: 800; color: white; margin-bottom: 3px; }
        .award-worker-rank-modal {
            font-size: 11px; color: rgba(255,200,80,0.7); font-weight: 700; margin-bottom: 16px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .award-pillars { display: flex; flex-direction: column; gap: 8px; }
        .award-pillar {
            display: flex; align-items: center; gap: 8px;
            background: rgba(255,255,255,0.06); border-radius: 10px;
            padding: 8px 12px; text-align: left;
        }
        .pillar-icon { font-size: 16px; flex-shrink: 0; }
        .pillar-text { font-size: 12px; color: rgba(255,255,255,0.8); font-weight: 600; }
        .pillar-sub { font-size: 10px; color: rgba(255,200,80,0.6); margin-top: 1px; }
        .award-divider-line {
            width: 60px; height: 2px; margin: 18px auto;
            background: linear-gradient(90deg, transparent, rgba(255,200,80,0.5), transparent);
        }
        .award-message-box {
            background: rgba(255,200,80,0.07);
            border: 1px solid rgba(255,200,80,0.2);
            border-radius: 14px; padding: 20px 24px; margin-bottom: 24px; text-align: center;
        }
        .award-message-text { font-size: 14px; color: rgba(255,255,255,0.85); line-height: 1.7; }
        .award-message-text strong { color: #fcf6ba; }
        .award-close-btn {
            display: block; width: 100%;
            background: linear-gradient(135deg, #bf953f 0%, #fcf6ba 50%, #b38728 100%);
            color: #0f0c29; border: none; padding: 15px 30px;
            border-radius: 12px; font-weight: 900; font-size: 15px;
            cursor: pointer; letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(180,130,0,0.4);
            transition: all 0.3s ease;
        }
        .award-close-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 35px rgba(180,130,0,0.55); }

        /* ===== TRASH ===== */
        #trashSection { display: none; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 3px dashed #f87171; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <img src="https://i.postimg.cc/9rn4BN6W/NFVT-Logo.jpg" style="width: 90px; margin-bottom: 20px; border-radius: 12px;">
        <h2 style="margin: 0 0 20px 0; font-size: 20px; color: #1e293b;">Team Followup Login</h2>
        <input type="number" id="loginId" placeholder="Distributor ID" style="margin-bottom: 12px;">
        <input type="text" id="loginName" placeholder="Your Name" style="margin-top: 0;">
        <button onclick="checkLogin()" style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%; font-weight: 700;">Login</button>
    </div>
</div>

<div class="container" id="mainApp">
    <!-- Golden profile bar -->
    <div class="user-profile-bar">
        <div class="user-details">
            <div class="user-avatar" id="userInitial">U</div>
            <div>
                <div style="font-size: 16px; font-weight: 800;" id="displayUserName">User Name</div>
                <div style="font-size: 12px; opacity: 0.7;" id="displayUserId">ID: 00000000</div>
            </div>
        </div>
        <div>
            <button class="language-toggle" onclick="toggleLanguage()">
                <span id="langBtn">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</span>
            </button>
            <button onclick="location.reload()" class="logout-btn">
                <span class="lang-text" data-en="Logout" data-ta="‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ">Logout</span>
            </button>
        </div>
    </div>

    <!-- Animated stats/alerts bar -->
    <div class="stats-summary" id="totalStats" onclick="scrollToAlerts()">
        <span class="lang-text" data-en="Total Team PV: 0 | Members: 0 | Alerts: 0" data-ta="‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ ‡Æï‡ØÅ‡Æ¥‡ØÅ PV: 0 | ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡Øç: 0 | ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç: 0">Total Team PV: 0 | Members: 0 | Alerts: 0</span>
    </div>

    <div class="header-section">
        <img src="https://i.postimg.cc/9rn4BN6W/NFVT-Logo.jpg" alt="NFVT Logo" class="team-logo">
        <h1 class="luxury-gold-title">NFVT Team Followup</h1>
    </div>

    <!-- ===== BEST WORKERS BANNER with FIX 1 (slow realistic stars) + FIX 2 (minimal ring) ===== -->
    <div class="best-workers-banner" onclick="openAwardModal()">
        <div class="nebula-bg"></div>
        <div class="star-field"></div>
        <div class="star-field-2"></div>
        <div class="gold-dust" id="goldDust"></div>

        <div class="banner-inner">
            <!-- Worker 1 ‚Äî FIX 2: Minimal ring, centered face -->
            <div class="banner-worker">
                <div class="banner-worker-photo">
                    <div class="banner-photo-ring-wrap">
                        <div class="ring-glow-pulse"></div>
                        <div class="minimal-gold-ring-2"></div>
                        <div class="minimal-gold-ring"></div>
                        <img class="worker-photo-img" src="https://i.postimg.cc/hjsf0q6t/Sukila.jpg" alt="Sukila">
                        <div class="banner-badge">ü•á</div>
                    </div>
                </div>
                <div class="banner-worker-info">
                    <div class="banner-worker-rank">Best Worker #1</div>
                    <div class="banner-worker-name">Sukila</div>
                    <div class="banner-worker-title">Bronze Director</div>
                </div>
            </div>

            <div class="banner-divider"></div>

            <!-- Center Title -->
            <div class="banner-title-section">
                <div class="banner-crown">üëë</div>
                <div class="banner-month-label" id="bannerMonthLabel">This Month</div>
                <div class="banner-main-title">Best Workers</div>
                <div class="banner-sub-title">Excellence ¬∑ Commitment ¬∑ Results</div>
            </div>

            <div class="banner-divider"></div>

            <!-- Worker 2 -->
            <div class="banner-worker right">
                <div class="banner-worker-photo">
                    <div class="banner-photo-ring-wrap">
                        <div class="ring-glow-pulse" style="animation-delay:1.4s;"></div>
                        <div class="minimal-gold-ring-2" style="animation-direction:reverse; animation-delay:0.5s;"></div>
                        <div class="minimal-gold-ring" style="animation-direction:reverse;"></div>
                        <img class="worker-photo-img" src="https://i.postimg.cc/J0ht62C2/Harini.jpg" alt="Harini Gopalakrishnan">
                        <div class="banner-badge">ü•à</div>
                    </div>
                </div>
                <div class="banner-worker-info" style="text-align:right;">
                    <div class="banner-worker-rank">Best Worker #2</div>
                    <div class="banner-worker-name">Harini G.</div>
                    <div class="banner-worker-title">Bronze Director</div>
                </div>
            </div>
        </div>
        <div class="banner-click-hint">‚ú® Click to view their achievements ‚ú®</div>
    </div>

    <div class="form-section">
        <div class="grid-form">
            <div class="input-group">
                <label class="lang-text" data-en="Member Name" data-ta="‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç">Member Name</label>
                <input type="text" id="downlineName">
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Mobile Number" data-ta="‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Øç ‡Æé‡Æ£‡Øç">Mobile Number</label>
                <input type="number" id="mobileNo">
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Distributor ID" data-ta="‡Æµ‡Æø‡Æ®‡Æø‡ÆØ‡Øã‡Æï‡Æ∏‡Øç‡Æ§‡Æ∞‡Øç ID">Distributor ID</label>
                <input type="number" id="distId">
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Level" data-ta="‡Æ®‡Æø‡Æ≤‡Øà">Level</label>
                <select id="memberLevel">
                    <option value="Distributor">Distributor</option>
                    <option value="Senior Distributor">Senior Distributor</option>
                    <option value="Assistant Bronze Director">Assistant Bronze Director</option>
                    <option value="Bronze Director">Bronze Director</option>
                    <option value="Silver Director">Silver Director</option>
                    <option value="Gold Director">Gold Director</option>
                    <option value="Star Director">Star Director</option>
                    <option value="Diamond Director">Diamond Director</option>
                    <option value="Crown Director">Crown Director</option>
                    <option value="UCD">UCD</option>
                </select>
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Self PV" data-ta="‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV">Self PV</label>
                <input type="number" id="selfPV">
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Group PV (PGPV)" data-ta="‡Æï‡ØÅ‡Æ¥‡ØÅ PV">Group PV (PGPV)</label>
                <input type="number" id="groupPV">
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Date" data-ta="‡Æ§‡Øá‡Æ§‡Æø">Date</label>
                <input type="date" id="followUpDate">
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="100PV CNC" data-ta="100PV ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø">100PV CNC</label>
                <select id="consistency">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Meeting" data-ta="‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç">Meeting</label>
                <select id="meeting">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="input-group">
                <label class="lang-text" data-en="Any New Joiners?" data-ta="‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Øà?">Any New Joiners?</label>
                <select id="newJoiners">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <button class="add-btn" onclick="addData()">
                <span class="lang-text" data-en="‚ûï Add Member" data-ta="‚ûï ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øà ‡Æö‡Øá‡Æ∞‡Øç">‚ûï Add Member</span>
            </button>
        </div>
    </div>

    <div class="action-bar">
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="üîç Search...">
        <div class="btn-group">
            <button class="btn-success" onclick="downloadCSV()">
                <span class="lang-text" data-en="üìä Excel" data-ta="üìä ‡Æé‡Æï‡Øç‡Æö‡ØÜ‡Æ≤‡Øç">üìä Excel</span>
            </button>
            <button class="btn-danger" onclick="downloadPDF()">
                <span class="lang-text" data-en="üìÑ PDF" data-ta="üìÑ PDF">üìÑ PDF</span>
            </button>
            <button class="btn-settings" onclick="showReports()">
                <span class="lang-text" data-en="üìà Reports" data-ta="üìà ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç">üìà Reports</span>
            </button>
            <button class="btn-trash" onclick="toggleTrash()">
                <span class="lang-text" data-en="üóëÔ∏è Trash" data-ta="üóëÔ∏è ‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Øà">üóëÔ∏è Trash</span>
            </button>
        </div>
    </div>

    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th class="lang-text" data-en="‚ö° Status" data-ta="‚ö° ‡Æ®‡Æø‡Æ≤‡Øà">‚ö° Status</th>
                    <th class="lang-text" data-en="Member & ID" data-ta="‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç & ID">Member & ID</th>
                    <th class="lang-text" data-en="Mobile" data-ta="‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Øç">Mobile</th>
                    <th class="lang-text" data-en="Level" data-ta="‡Æ®‡Æø‡Æ≤‡Øà">Level</th>
                    <th class="lang-text" data-en="Self PV" data-ta="‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV">Self PV</th>
                    <th class="lang-text" data-en="Group PV (PGPV)" data-ta="‡Æï‡ØÅ‡Æ¥‡ØÅ PV">Group PV (PGPV)</th>
                    <th class="lang-text" data-en="Total PV" data-ta="‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ PV">Total PV</th>
                    <th class="lang-text" data-en="Date" data-ta="‡Æ§‡Øá‡Æ§‡Æø">Date</th>
                    <th class="lang-text" data-en="100PV" data-ta="100PV">100PV</th>
                    <th class="lang-text" data-en="Meeting" data-ta="‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç">Meeting</th>
                    <th class="lang-text" data-en="New Joiners" data-ta="‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Øà">New Joiners</th>
                    <th class="lang-text" data-en="Actions" data-ta="‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æï‡Æ≥‡Øç">Actions</th>
                    <th>WA</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <span class="lang-text" data-en="‚úèÔ∏è Edit Member Details" data-ta="‚úèÔ∏è ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ">‚úèÔ∏è Edit Member Details</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editId">
                <div class="grid-form">
                    <div class="input-group">
                        <label class="lang-text" data-en="Member Name" data-ta="‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç">Member Name</label>
                        <input type="text" id="editName">
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="Mobile Number" data-ta="‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Øç ‡Æé‡Æ£‡Øç">Mobile Number</label>
                        <input type="number" id="editMobile">
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="Self PV" data-ta="‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV">Self PV</label>
                        <input type="number" id="editSelfPV">
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="Group PV (PGPV)" data-ta="‡Æï‡ØÅ‡Æ¥‡ØÅ PV">Group PV (PGPV)</label>
                        <input type="number" id="editGroupPV">
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="Date" data-ta="‡Æ§‡Øá‡Æ§‡Æø">Date</label>
                        <input type="date" id="editDate">
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="100PV CNC" data-ta="100PV ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø">100PV CNC</label>
                        <select id="editConsistency">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="Meeting" data-ta="‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç">Meeting</label>
                        <select id="editMeeting">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="lang-text" data-en="Any New Joiners?" data-ta="‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Øà?">Any New Joiners?</label>
                        <select id="editNewJoiners">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="modal-btn" onclick="saveEdit()">
                    <span class="lang-text" data-en="üíæ Save Changes" data-ta="üíæ ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æö‡Øá‡ÆÆ‡Æø">üíæ Save Changes</span>
                </button>
                <button class="modal-btn modal-btn-close" onclick="closeEditModal()">
                    <span class="lang-text" data-en="Close" data-ta="‡ÆÆ‡ØÇ‡Æü‡ØÅ">Close</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="modal-overlay">
        <div class="modal-content" style="max-width:750px;">
            <div class="modal-header">
                <span class="lang-text" data-en="üìä Reports & Analytics" data-ta="üìä ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç & ‡Æ™‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ">üìä Reports & Analytics</span>
            </div>
            <div class="modal-body" id="reportsContent"></div>
            <div style="text-align: center;">
                <button class="modal-btn" onclick="downloadMonthlyReport()">
                    <span class="lang-text" data-en="üìÑ Download Monthly Report" data-ta="üìÑ ‡ÆÆ‡Ææ‡Æ§‡Ææ‡Æ®‡Øç‡Æ§‡Æø‡Æ∞ ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡ØÅ">üìÑ Download Monthly Report</span>
                </button>
                <button class="modal-btn modal-btn-close" onclick="closeReportsModal()">
                    <span class="lang-text" data-en="Close" data-ta="‡ÆÆ‡ØÇ‡Æü‡ØÅ">Close</span>
                </button>
            </div>
        </div>
    </div>

    <div id="trashSection" style="display: none; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 20px; border-radius: 15px; margin: 25px 0; border: 3px dashed #f87171;">
        <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #dc2626; font-weight: 800;">
            <span class="lang-text" data-en="‚ôªÔ∏è Deleted Members" data-ta="‚ôªÔ∏è ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡Øç">‚ôªÔ∏è Deleted Members</span>
        </h3>
        <table style="background: transparent;"><tbody id="trashBody"></tbody></table>
        <button onclick="toggleTrash()" style="font-size: 12px; cursor: pointer; padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 6px; margin-top: 10px; font-weight: 700;">
            <span class="lang-text" data-en="Close Trash" data-ta="‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Øà‡ÆØ‡Øà ‡ÆÆ‡ØÇ‡Æü‡ØÅ">Close Trash</span>
        </button>
        <button onclick="emptyTrash()" style="font-size: 12px; cursor: pointer; padding: 8px 16px; background: #7f1d1d; color: white; border: none; border-radius: 6px; margin-top: 10px; margin-left: 10px; font-weight: 700;">
            <span class="lang-text" data-en="üóëÔ∏è Empty Trash" data-ta="üóëÔ∏è ‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Øà‡ÆØ‡Øà ‡Æï‡Ææ‡Æ≤‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç">üóëÔ∏è Empty Trash</span>
        </button>
    </div>

    <div class="branding-bar">
        <div class="leader-card-inline">
            <div class="profile-circle-small"><img src="https://i.postimg.cc/XvTq85tC/Girish-S.jpg"></div>
            <div>
                <p class="leader-name-small">Girish S</p>
                <span class="leader-rank-small">Universal Crown Director of Vestige</span>
                <span class="team-tag">DUCD Saravanan Team</span>
            </div>
        </div>
        <img src="https://i.postimg.cc/PNWQDG2x/New-Logo.jpg" alt="Team Branding" class="inline-logo">
    </div>
</div>

<!-- AWARD MODAL -->
<div id="awardModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:9000; justify-content:center; align-items:center; backdrop-filter:blur(8px);">
    <div class="award-modal-box">
        <div class="award-confetti-top"></div>
        <div class="award-modal-inner">
            <div class="award-header">
                <div class="award-header-crown">üëë</div>
                <div class="award-header-month" id="awardMonthFull"></div>
                <div class="award-header-title">Best Workers of the Month</div>
                <div class="award-header-sub">Recognizing Excellence ¬∑ Follow-up ¬∑ Commitment ¬∑ Consistency ¬∑ Results</div>
            </div>

            <div class="award-workers-grid">
                <div class="award-worker-card">
                    <div class="award-worker-card-num">1</div>
                    <div class="award-photo-wrap">
                        <div class="ring-glow-pulse"></div>
                        <div class="minimal-gold-ring-2"></div>
                        <div class="minimal-gold-ring"></div>
                        <img class="worker-photo-img" src="https://i.postimg.cc/hjsf0q6t/Sukila.jpg" alt="Sukila">
                        <div class="award-photo-ring"></div>
                    </div>
                    <div class="award-worker-badge-label">ü•á Best Worker</div>
                    <div class="award-worker-name-modal">Sukila</div>
                    <div class="award-worker-rank-modal">Bronze Director</div>
                    <div class="award-pillars">
                        <div class="award-pillar"><span class="pillar-icon">üéØ</span><div><div class="pillar-text">Excellence of Work</div><div class="pillar-sub">Outstanding quality every day</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üìû</span><div><div class="pillar-text">Follow-up Champion</div><div class="pillar-sub">Never misses a follow-up</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üí™</span><div><div class="pillar-text">Commitment</div><div class="pillar-sub">100% dedicated to the team</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üîÅ</span><div><div class="pillar-text">Consistency</div><div class="pillar-sub">Consistent 100PV every cycle</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üèÜ</span><div><div class="pillar-text">Results Driven</div><div class="pillar-sub">Proven growth & results</div></div></div>
                    </div>
                </div>

                <div class="award-worker-card">
                    <div class="award-worker-card-num">2</div>
                    <div class="award-photo-wrap">
                        <div class="ring-glow-pulse" style="animation-delay:1.4s;"></div>
                        <div class="minimal-gold-ring-2" style="animation-direction:reverse; animation-delay:0.5s;"></div>
                        <div class="minimal-gold-ring" style="animation-direction:reverse;"></div>
                        <img class="worker-photo-img" src="https://i.postimg.cc/J0ht62C2/Harini.jpg" alt="Harini Gopalakrishnan">
                        <div class="award-photo-ring"></div>
                    </div>
                    <div class="award-worker-badge-label">ü•à Best Worker</div>
                    <div class="award-worker-name-modal">Harini Gopalakrishnan</div>
                    <div class="award-worker-rank-modal">Bronze Director</div>
                    <div class="award-pillars">
                        <div class="award-pillar"><span class="pillar-icon">üéØ</span><div><div class="pillar-text">Excellence of Work</div><div class="pillar-sub">Sets the standard for the team</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üìû</span><div><div class="pillar-text">Follow-up Champion</div><div class="pillar-sub">Proactive & timely follow-ups</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üí™</span><div><div class="pillar-text">Commitment</div><div class="pillar-sub">Goes above and beyond always</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üîÅ</span><div><div class="pillar-text">Consistency</div><div class="pillar-sub">Steady performance month over month</div></div></div>
                        <div class="award-pillar"><span class="pillar-icon">üèÜ</span><div><div class="pillar-text">Results Driven</div><div class="pillar-sub">Delivers measurable team growth</div></div></div>
                    </div>
                </div>
            </div>

            <div class="award-message-box">
                <div class="award-message-text">
                    üåü <strong>Congratulations Sukila & Harini Gopalakrishnan!</strong> üåü<br>
                    Your relentless dedication to <strong>follow-up</strong>, unwavering <strong>commitment</strong>,
                    and rock-solid <strong>consistency</strong> have produced outstanding <strong>results</strong> this month.
                    You are the true pillars of <strong>Team NFVT</strong> ‚Äî inspiring everyone around you.
                    Keep shining and leading the way to success! üí´
                </div>
            </div>

            <button class="award-close-btn" onclick="closeAwardModal()">
                ‚ú® Congratulations! Close
            </button>
        </div>
    </div>
</div>

<!-- New Joiners Reminder Modal -->
<div id="newJoinerReminderModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:9500;justify-content:center;align-items:center;backdrop-filter:blur(6px);">
    <div style="background:linear-gradient(145deg,#0f172a,#1e293b);border:2px solid rgba(99,102,241,0.5);border-radius:24px;width:90%;max-width:520px;padding:36px 32px;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,0.7),0 0 50px rgba(99,102,241,0.2);animation:awardAppear 0.5s cubic-bezier(0.34,1.56,0.64,1);">
        <div style="font-size:52px;margin-bottom:10px;animation:crownFloat 2.5s ease-in-out infinite;">üì°</div>
        <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:900;background:linear-gradient(45deg,#a78bfa,#c4b5fd,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px;">Daily Team Conference Call</div>
        <div style="font-size:11px;font-weight:800;letter-spacing:4px;color:rgba(167,139,250,0.7);text-transform:uppercase;margin-bottom:18px;">FOCUS REMINDER</div>
        <div style="background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.3);border-radius:14px;padding:18px 20px;margin-bottom:22px;text-align:left;">
            <div id="noNewJoinerMembers" style="color:rgba(255,255,255,0.85);font-size:14px;line-height:1.8;"></div>
        </div>
        <div style="background:rgba(167,139,250,0.08);border:1px solid rgba(167,139,250,0.2);border-radius:12px;padding:14px 18px;margin-bottom:22px;font-size:13px;color:rgba(255,255,255,0.8);line-height:1.7;">
            üìû <strong style="color:#c4b5fd;">Focus on Daily Team Conference Calls with your upline!</strong><br>
            Regular calls build momentum, accountability and help bring in <strong style="color:#a78bfa;">New Joiners</strong> faster!
        </div>
        <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
            <button onclick="sendNewJoinerWAReminders()" style="background:linear-gradient(135deg,#6366f1,#4f46e5);color:white;border:none;padding:12px 24px;border-radius:10px;font-weight:800;cursor:pointer;font-size:14px;box-shadow:0 6px 20px rgba(99,102,241,0.4);">üì± Send WA Reminder</button>
            <button onclick="closeNewJoinerModal()" style="background:rgba(255,255,255,0.1);color:white;border:1px solid rgba(255,255,255,0.2);padding:12px 24px;border-radius:10px;font-weight:700;cursor:pointer;font-size:14px;">Close</button>
        </div>
    </div>
</div>

<script>
    let currentLanguage = 'en';
    let loggedInUser = {};
    let dailyTargetPercentage = 8;
    let noJoinerMembersCache = [];

    // Spawn gold dust
    function spawnGoldDust() {
        const container = document.getElementById('goldDust');
        if (!container) return;
        for (let i = 0; i < 18; i++) {
            const p = document.createElement('div');
            p.className = 'dust-particle';
            const x = Math.random() * 100;
            const delay = Math.random() * 8;
            const dur = 5 + Math.random() * 8;
            const size = 1 + Math.random() * 3;
            p.style.cssText = `left:${x}%;bottom:-10px;width:${size}px;height:${size}px;animation:dustFloat ${dur}s ${delay}s linear infinite;opacity:0;`;
            container.appendChild(p);
        }
    }

    const dustStyle = document.createElement('style');
    dustStyle.textContent = `
        @keyframes dustFloat {
            0% { transform: translateY(0) translateX(0) scale(1); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-200px) translateX(20px) scale(0.3); opacity: 0; }
        }
        @keyframes awardAppear {
            from { opacity: 0; transform: scale(0.7) translateY(40px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
    `;
    document.head.appendChild(dustStyle);

    window.addEventListener('load', function() {
        const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        const now = new Date();
        const monthName = months[now.getMonth()] + ' ' + now.getFullYear();
        const el = document.getElementById('bannerMonthLabel');
        if (el) el.textContent = monthName;
        const el2 = document.getElementById('awardMonthFull');
        if (el2) el2.textContent = monthName.toUpperCase();
        const saved = localStorage.getItem('dailyTargetPercentage');
        if (saved) dailyTargetPercentage = parseFloat(saved);
        document.getElementById('followUpDate').value = new Date().toISOString().split('T')[0];
        spawnGoldDust();
    });

    function openAwardModal() {
        document.getElementById('awardModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    function closeAwardModal() {
        document.getElementById('awardModal').style.display = 'none';
        document.body.style.overflow = '';
    }
    document.getElementById('awardModal').addEventListener('click', function(e) {
        if (e.target === this) closeAwardModal();
    });

    function scrollToAlerts() {
        const firstAlert = document.querySelector('#tableBody tr.inactive-warning, #tableBody tr.low-pv-warning, #tableBody tr.no-consistency, #tableBody tr.no-meeting');
        if (firstAlert) firstAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function checkNewJoiners() {
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const noJoiners = entries.filter(e => e.newJoiners === 'No' || !e.newJoiners);
        if (noJoiners.length > 0) {
            const lastReminder = localStorage.getItem('lastNewJoinerReminder');
            const today = new Date().toDateString();
            if (lastReminder !== today) {
                noJoinerMembersCache = noJoiners;
                showNewJoinerReminder(noJoiners);
                localStorage.setItem('lastNewJoinerReminder', today);
            }
        }
    }

    function showNewJoinerReminder(members) {
        const el = document.getElementById('noNewJoinerMembers');
        el.innerHTML = `<strong style="color:#a78bfa;font-size:15px;">üö® ${members.length} member${members.length>1?'s':''} have NO new joiners this cycle:</strong><br><br>` +
            members.slice(0, 8).map(m => `‚Ä¢ <strong>${m.name}</strong> (${m.distId})`).join('<br>') +
            (members.length > 8 ? `<br><em style="color:rgba(255,255,255,0.5);">...and ${members.length-8} more</em>` : '');
        document.getElementById('newJoinerReminderModal').style.display = 'flex';
    }

    function closeNewJoinerModal() {
        document.getElementById('newJoinerReminderModal').style.display = 'none';
    }

    function sendNewJoinerWAReminders() {
        noJoinerMembersCache.forEach((member, index) => {
            const waMessage = currentLanguage === 'en'
                ? `Hello ${member.name}! üëã\n\nüì° *DAILY TEAM CONFERENCE CALL REMINDER*\n\nüéØ You currently have *NO new joiners* this cycle.\n\nüí° *Key Action: Focus on Daily Conference Calls with your Upline!*\n\nüìû *Why Daily Calls Matter:*\n- Build momentum & stay accountable\n- Get guidance from experienced leaders\n- Identify prospects faster\n- Grow your team consistently\n\nüî• *Your Daily Routine:*\n‚úÖ Attend team conference call every day\n‚úÖ Follow up on 5+ prospects\n‚úÖ Share the business opportunity\n‚úÖ Invite to the next meeting\n\nüí™ *Remember:* Every big team started with ONE joiner!\n\nüìà Let's bring in new joiners this week!\n\nüåü Team NFVT - Together we grow!`
                : `‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç ${member.name}! üëã\n\nüì° *‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æï‡ØÅ‡Æ¥‡ØÅ ‡Æï‡Ææ‡Æ©‡Øç‡Æ™‡Æ∞‡Æ©‡Øç‡Æ∏‡Øç ‡Æï‡Ææ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç*\n\nüéØ ‡Æá‡Æ®‡Øç‡Æ§ ‡Æö‡Øà‡Æï‡Øç‡Æï‡Æø‡Æ≥‡Æø‡Æ≤‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ *‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Øà ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà*.\n\nüí° *‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡Æ®‡Æü‡Æµ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà: Upline ‡Æâ‡Æü‡Æ©‡Øç ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æï‡Ææ‡Æ©‡Øç‡Æ™‡Æ∞‡Æ©‡Øç‡Æ∏‡Øç ‡Æï‡Ææ‡Æ≤‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æï‡Æµ‡Æ©‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!*\n\nüí™ *‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡Æø‡Æ≤‡Øç ‡Æµ‡Øà‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç:* ‡Æí‡Æµ‡Øç‡Æµ‡Øä‡Æ∞‡ØÅ ‡Æ™‡ØÜ‡Æ∞‡Æø‡ÆØ ‡Æï‡ØÅ‡Æ¥‡ØÅ‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æí‡Æ∞‡ØÅ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Æø‡Æ≤‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡Æø‡ÆØ‡Æ§‡ØÅ!\n\nüåü Team NFVT - ‡Æí‡Æ©‡Øç‡Æ±‡Ææ‡Æï ‡Æµ‡Æ≥‡Æ∞‡ØÅ‡Æµ‡Øã‡ÆÆ‡Øç!`;
            setTimeout(() => { window.open(`https://wa.me/91${member.mobile}?text=${encodeURIComponent(waMessage)}`, '_blank'); }, index * 2000);
        });
        closeNewJoinerModal();
    }

    function check100PVReminder() {
        const today = new Date();
        const dayOfMonth = today.getDate();
        if (dayOfMonth >= 2 && dayOfMonth <= 14) {
            const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
            const below100PV = entries.filter(e => e.selfPV < 100);
            if (below100PV.length > 0) {
                const lastReminder = localStorage.getItem('last100PVReminder');
                const todayStr = today.toDateString();
                if (lastReminder !== todayStr) {
                    show100PVReminderPopup(below100PV, dayOfMonth);
                    localStorage.setItem('last100PVReminder', todayStr);
                }
            }
        }
    }

    function show100PVReminderPopup(members, currentDay) {
        const daysLeft = 14 - currentDay;
        const message = currentLanguage === 'en'
            ? `‚è∞ 100PV CONSISTENCY REMINDER!\n\n${members.length} members have not completed 100 PV yet.\n\n‚ö†Ô∏è ${daysLeft} days left! Complete before 14th of this month.\n\nüéÅ DON'T MISS: Consistency Product Voucher worth ‚Çπ2500!\n\nWould you like to send WhatsApp reminders?`
            : `‚è∞ 100PV ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç!\n\n${members.length} ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ©‡Øç‡Æ©‡ØÅ‡ÆÆ‡Øç 100 PV ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.\n\n‚ö†Ô∏è ${daysLeft} ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá! ‡Æá‡Æ®‡Øç‡Æ§ ‡ÆÆ‡Ææ‡Æ§‡ÆÆ‡Øç 14‡Æï‡Øç‡Æï‡ØÅ‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.\n\nüéÅ ‡Æ§‡Æµ‡Æ±‡Æµ‡Æø‡Æü‡Ææ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç: ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æµ‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Æ∞‡Øç ‚Çπ2500 ‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡ØÅ!\n\nWhatsApp ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™ ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?`;
        if (confirm(message)) { send100PVReminders(members, daysLeft); }
    }

    function send100PVReminders(members, daysLeft) {
        members.forEach((member, index) => {
            const needed = 100 - member.selfPV;
            const waMessage = currentLanguage === 'en'
                ? `Hello ${member.name}! üëã\n\n‚è∞ *100PV CONSISTENCY REMINDER*\n\nüìÖ Deadline: Before 14th of this month (${daysLeft} days left)\nüìä Your Current Self PV: ${member.selfPV}\nüéØ Target: 100 PV\n‚ö†Ô∏è Remaining: *${needed} PV*\n\nüéÅ *SPECIAL BENEFIT:*\nComplete 100 PV consistency and get Product Voucher worth *‚Çπ2500*!\n\nüí° Don't miss this opportunity!\n\nüí™ Complete your ${needed} PV before 14th!\n\nüåü Team NFVT - Success is yours!`
                : `‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç ${member.name}! üëã\n\n‚è∞ *100PV ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç*\n\nüìÖ ‡Æï‡Æü‡Øà‡Æö‡Æø ‡Æ®‡Ææ‡Æ≥‡Øç: ‡Æá‡Æ®‡Øç‡Æ§ ‡ÆÆ‡Ææ‡Æ§‡ÆÆ‡Øç 14‡Æï‡Øç‡Æï‡ØÅ‡Æ≥‡Øç (${daysLeft} ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ©)\nüìä ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV: ${member.selfPV}\nüéØ ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ: 100 PV\n‚ö†Ô∏è ‡ÆÆ‡ØÄ‡Æ§‡ÆÆ‡Øç: *${needed} PV*\n\nüéÅ *‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ™‡Æ≤‡Æ©‡Øç:*\n100 PV ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø‡ÆØ‡Øà ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ§‡Øç‡Æ§‡ØÅ *‚Çπ2500* ‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æµ‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Æ∞‡Øà‡Æ™‡Øç ‡Æ™‡ØÜ‡Æ±‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!\n\nüí™ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ${needed} PV ‡Æê 14‡Æï‡Øç‡Æï‡ØÅ‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç!\n\nüåü Team NFVT - ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æü‡Øà‡ÆØ‡Æ§‡ØÅ!`;
            setTimeout(() => { window.open(`https://wa.me/91${member.mobile}?text=${encodeURIComponent(waMessage)}`, '_blank'); }, index * 2000);
        });
    }

    function checkLowGroupPV() {
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const lowGroupPV = entries.filter(e => e.groupPV < 2600);
        if (lowGroupPV.length > 0) {
            const lastReminder = localStorage.getItem('lastLowGroupPVReminder');
            const today = new Date().toDateString();
            if (lastReminder !== today) {
                showLowGroupPVPopup(lowGroupPV);
                localStorage.setItem('lastLowGroupPVReminder', today);
            }
        }
    }

    function showLowGroupPVPopup(members) {
        const message = currentLanguage === 'en'
            ? `‚ö†Ô∏è LOW Group PV (PGPV) ALERT!\n\n${members.length} members have Group PV (PGPV) below 2600.\n\nThey need to improve their team building!\n\nWould you like to send WhatsApp reminders?`
            : `‚ö†Ô∏è ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§ ‡Æï‡ØÅ‡Æ¥‡ØÅ PV ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà!\n\n${members.length} ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ 2600‡Æï‡Øç‡Æï‡ØÅ ‡Æï‡ØÄ‡Æ¥‡Øç ‡Æï‡ØÅ‡Æ¥‡ØÅ PV ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ.\n\n‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡ØÅ‡Æ¥‡ØÅ ‡Æï‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡Øà ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç!\n\nWhatsApp ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™ ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?`;
        if (confirm(message)) { sendLowGroupPVReminders(members); }
    }

    function sendLowGroupPVReminders(members) {
        members.forEach((member, index) => {
            const needed = 2600 - member.groupPV;
            const waMessage = currentLanguage === 'en'
                ? `Hello ${member.name}! üëã\n\n‚ö†Ô∏è *Group PV (PGPV) IMPROVEMENT NEEDED*\n\nüìä Your Current Group PV (PGPV): ${member.groupPV}\nüéØ Target: 2600 PV\nüìà Need to Improve: *${needed} PV*\n\nüí° *Action Required:*\n- Focus on team building\n- Help your downlines achieve their targets\n- Conduct more team meetings\n- Support your team members\n\nüí™ Build your team stronger!\n\nüåü Team NFVT - Together we grow!`
                : `‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç ${member.name}! üëã\n\n‚ö†Ô∏è *‡Æï‡ØÅ‡Æ¥‡ØÅ PV ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Ææ‡Æü‡ØÅ ‡Æ§‡Øá‡Æµ‡Øà*\n\nüìä ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æï‡ØÅ‡Æ¥‡ØÅ PV: ${member.groupPV}\nüéØ ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ: 2600 PV\nüìà ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡Æø‡ÆØ‡Æ§‡ØÅ: *${needed} PV*\n\nüí™ ‡Æï‡ØÅ‡Æ¥‡ØÅ‡Æµ‡Øà ‡Æµ‡Æ≤‡ØÅ‡Æµ‡Ææ‡Æï ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!\n\nüåü Team NFVT - ‡Æí‡Æ©‡Øç‡Æ±‡Ææ‡Æï ‡Æµ‡Æ≥‡Æ∞‡ØÅ‡Æµ‡Øã‡ÆÆ‡Øç!`;
            setTimeout(() => { window.open(`https://wa.me/91${member.mobile}?text=${encodeURIComponent(waMessage)}`, '_blank'); }, index * 2000);
        });
    }

    function checkInactiveIDs() {
        const today = new Date();
        const dayOfMonth = today.getDate();
        const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
        if (dayOfMonth >= 25) {
            const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
            const inactiveIDs = entries.filter(e => e.selfPV < 30);
            if (inactiveIDs.length > 0) {
                const lastReminder = localStorage.getItem('lastInactiveIDReminder');
                const todayStr = today.toDateString();
                if (lastReminder !== todayStr) {
                    showInactiveIDPopup(inactiveIDs, lastDayOfMonth - dayOfMonth);
                    localStorage.setItem('lastInactiveIDReminder', todayStr);
                }
            }
        }
    }

    function showInactiveIDPopup(members, daysLeft) {
        const message = currentLanguage === 'en'
            ? `üö® URGENT: INACTIVE ID ALERT!\n\n${members.length} members have Self PV below 30.\n\n‚ö†Ô∏è Their IDs will become INACTIVE!\n‚ö†Ô∏è They will lose team support benefits!\n\n${daysLeft} days left before month end!\n\nWould you like to send WhatsApp reminders?`
            : `üö® ‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç: ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æ±‡Øç‡Æ± ID ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà!\n\n${members.length} ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ 30‡Æï‡Øç‡Æï‡ØÅ ‡Æï‡ØÄ‡Æ¥‡Øç ‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ.\n\n‚ö†Ô∏è ‡ÆÖ‡Æµ‡Æ∞‡Øç‡Æï‡Æ≥‡Æø‡Æ©‡Øç ID ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æ±‡Øç‡Æ±‡Æ§‡Ææ‡Æï‡Æø‡Æµ‡Æø‡Æü‡ØÅ‡ÆÆ‡Øç!\n\n‡ÆÆ‡Ææ‡Æ§‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ ${daysLeft} ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá!\n\nWhatsApp ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™ ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?`;
        if (confirm(message)) { sendInactiveIDReminders(members, daysLeft); }
    }

    function sendInactiveIDReminders(members, daysLeft) {
        members.forEach((member, index) => {
            const needed = 30 - member.selfPV;
            const waMessage = currentLanguage === 'en'
                ? `Hello ${member.name}! üëã\n\nüö® *URGENT - ID ACTIVATION ALERT*\n\n‚ö†Ô∏è Your ID will become INACTIVE!\n\nüìä Your Current Self PV: ${member.selfPV}\nüéØ Minimum Required: 30 PV\n‚ö†Ô∏è Need Immediately: *${needed} PV*\n\n‚è∞ Only *${daysLeft} days* left!\n\nüìû Contact your upline NOW for support!\n\nüí™ Don't lose your hard work!\n\nüåü Team NFVT - We support you!`
                : `‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç ${member.name}! üëã\n\nüö® *‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç - ID ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ≤‡Øç ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà*\n\n‚ö†Ô∏è ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ID ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æ±‡Øç‡Æ±‡Æ§‡Ææ‡Æï‡Æø‡Æµ‡Æø‡Æü‡ØÅ‡ÆÆ‡Øç!\n\nüìä ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV: ${member.selfPV}\nüéØ ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§‡Æ™‡Æü‡Øç‡Æö‡ÆÆ‡Øç: 30 PV\n‚ö†Ô∏è ‡Æâ‡Æü‡Æ©‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æ§‡Øá‡Æµ‡Øà: *${needed} PV*\n\n‚è∞ ‡Æµ‡ØÜ‡Æ±‡ØÅ‡ÆÆ‡Øç *${daysLeft} ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç* ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá!\n\nüåü Team NFVT - ‡Æ®‡Ææ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡ÆÜ‡Æ§‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç!`;
            setTimeout(() => { window.open(`https://wa.me/91${member.mobile}?text=${encodeURIComponent(waMessage)}`, '_blank'); }, index * 2000);
        });
    }

    function checkMeetingTime() {
        const now = new Date();
        const hours = now.getHours(); const minutes = now.getMinutes();
        if ((hours === 17 && minutes === 50) || (hours === 19 && minutes === 50)) {
            const meetingTime = hours === 17 ? "6:00 PM" : "8:00 PM";
            const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
            const today = new Date().toISOString().split('T')[0];
            const lastReminder = localStorage.getItem('lastMeetingReminder');
            if (lastReminder !== today + '-' + meetingTime) {
                const nonAttendees = entries.filter(e => e.meeting === 'No');
                if (nonAttendees.length > 0) {
                    showMeetingReminder(meetingTime, nonAttendees);
                    localStorage.setItem('lastMeetingReminder', today + '-' + meetingTime);
                }
            }
        }
    }

    function showMeetingReminder(time, members) {
        const message = currentLanguage === 'en' 
            ? `‚è∞ Meeting Alert!\n\nThe ${time} meeting is starting in 10 minutes.\n\n${members.length} members haven't attended recent meetings.\n\nConsistency is key to success!`
            : `‚è∞ ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà!\n\n${time} ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç 10 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.\n\n${members.length} ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ÆÆ‡ØÄ‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç ‡Æï‡Æ≤‡Æ®‡Øç‡Æ§‡ØÅ ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.`;
        if (confirm(message + '\n\nWould you like to send WhatsApp reminders?')) {
            members.forEach((member, index) => {
                const waMessage = currentLanguage === 'en'
                    ? `Hello ${member.name}! üëã\n\n‚è∞ Meeting Reminder!\n\nOur team meeting starts at ${time} (in 10 minutes).\n\nüìç Please join the meeting!\n\nüí™ See you there!`
                    : `‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç ${member.name}! üëã\n\n‚è∞ ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç!\n\n‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç ${time} (10 ‡Æ®‡Æø‡ÆÆ‡Æø‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Æø‡Æ≤‡Øç) ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.\n\nüí™ ‡ÆÖ‡Æô‡Øç‡Æï‡Øá ‡Æö‡Æ®‡Øç‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Øã‡ÆÆ‡Øç!`;
                setTimeout(() => { window.open(`https://wa.me/91${member.mobile}?text=${encodeURIComponent(waMessage)}`, '_blank'); }, index * 2000);
            });
        }
    }

    function checkInactivity() {
        const lastActive = localStorage.getItem('lastActiveDate');
        const today = new Date().toISOString().split('T')[0];
        if (lastActive && lastActive !== today) {
            const daysDiff = Math.floor((new Date(today) - new Date(lastActive)) / (1000 * 60 * 60 * 24));
            if (daysDiff >= 1) {
                const message = currentLanguage === 'en'
                    ? `‚ö†Ô∏è Consistency Alert!\n\nYou haven't updated your followup in ${daysDiff} day(s).\n\nüí° Daily consistency is very important for success!\n\nUpdate your team's progress daily to achieve your goals.`
                    : `‚ö†Ô∏è ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà!\n\n‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ${daysDiff} ‡Æ®‡Ææ‡Æ≥‡Øç‡Æï‡Æ≥‡Ææ‡Æï ‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.\n\nüí° ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡ÆÆ‡Æø‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡ÆÆ‡Øç!`;
                alert(message);
            }
        }
        localStorage.setItem('lastActiveDate', today);
    }

    function toggleLanguage() {
        currentLanguage = currentLanguage === 'en' ? 'ta' : 'en';
        document.getElementById('langBtn').textContent = currentLanguage === 'en' ? '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç' : 'English';
        document.querySelectorAll('.lang-text').forEach(el => {
            el.textContent = el.getAttribute('data-' + currentLanguage);
        });
        displayData();
        localStorage.setItem('preferredLanguage', currentLanguage);
    }

    function checkLogin() {
        const id = document.getElementById('loginId').value;
        const name = document.getElementById('loginName').value;
        if(id.length >= 8 && name.trim() !== "") {
            loggedInUser = { id, name };
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('displayUserName').innerText = name;
            document.getElementById('displayUserId').innerText = "ID: " + id;
            document.getElementById('userInitial').innerText = name.charAt(0).toUpperCase();
            const savedLang = localStorage.getItem('preferredLanguage');
            if (savedLang && savedLang !== currentLanguage) { toggleLanguage(); }
            checkInactivity();
            displayData();
            check100PVReminder();
            checkLowGroupPV();
            checkInactiveIDs();
            setTimeout(checkNewJoiners, 2000);
            setInterval(checkMeetingTime, 60000);
            setInterval(() => { check100PVReminder(); checkLowGroupPV(); checkInactiveIDs(); checkNewJoiners(); }, 3600000);
        } else {
            alert("Please enter valid 8-digit ID and Name!");
        }
    }

    function addData() {
        const name = document.getElementById('downlineName').value;
        const mobile = document.getElementById('mobileNo').value;
        const distId = document.getElementById('distId').value;
        const level = document.getElementById('memberLevel').value;
        const selfPV = parseFloat(document.getElementById('selfPV').value) || 0;
        const groupPV = parseFloat(document.getElementById('groupPV').value) || 0;
        const totalPV = selfPV + groupPV;
        const date = document.getElementById('followUpDate').value;
        const consistency = document.getElementById('consistency').value;
        const meeting = document.getElementById('meeting').value;
        const newJoiners = document.getElementById('newJoiners').value;
        if (!name || distId.length < 8 || !mobile) { 
            alert(currentLanguage === 'en' ? "‚ö†Ô∏è Please fill Name, ID (8 digits), and Mobile!" : "‚ö†Ô∏è ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç, ID (8 ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡Æô‡Øç‡Æï‡Æ≥‡Øç) ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Øç ‡Æ®‡Æø‡Æ∞‡Æ™‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç!"); 
            return; 
        }
        const entry = { name, mobile, distId, level, selfPV, groupPV, totalPV, date, consistency, meeting, newJoiners, id: Date.now(), timestamp: new Date().toISOString(), addedBy: loggedInUser.id };
        let entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        entries.unshift(entry); 
        localStorage.setItem('nfvt_ucd_v2', JSON.stringify(entries));
        updateActivityLog('add', entry);
        displayData();
        ['downlineName', 'mobileNo', 'distId', 'selfPV', 'groupPV'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('consistency').value = 'Yes';
        document.getElementById('meeting').value = 'Yes';
        document.getElementById('newJoiners').value = 'Yes';
    }

    function updateActivityLog(action, data) {
        let log = JSON.parse(localStorage.getItem('nfvt_activity_log')) || [];
        log.unshift({ action, data, timestamp: new Date().toISOString(), user: loggedInUser.name });
        if (log.length > 1000) log = log.slice(0, 1000);
        localStorage.setItem('nfvt_activity_log', JSON.stringify(log));
    }

    function editEntry(id) {
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const entry = entries.find(e => e.id === id);
        if (entry) {
            document.getElementById('editId').value = entry.id;
            document.getElementById('editName').value = entry.name;
            document.getElementById('editMobile').value = entry.mobile;
            document.getElementById('editSelfPV').value = entry.selfPV;
            document.getElementById('editGroupPV').value = entry.groupPV;
            document.getElementById('editDate').value = entry.date;
            document.getElementById('editConsistency').value = entry.consistency;
            document.getElementById('editMeeting').value = entry.meeting;
            document.getElementById('editNewJoiners').value = entry.newJoiners || 'No';
            document.getElementById('editModal').style.display = 'flex';
        }
    }

    function saveEdit() {
        const id = parseInt(document.getElementById('editId').value);
        let entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const idx = entries.findIndex(e => e.id === id);
        if (idx > -1) {
            const oldEntry = {...entries[idx]};
            entries[idx].name = document.getElementById('editName').value;
            entries[idx].mobile = document.getElementById('editMobile').value;
            entries[idx].selfPV = parseFloat(document.getElementById('editSelfPV').value) || 0;
            entries[idx].groupPV = parseFloat(document.getElementById('editGroupPV').value) || 0;
            entries[idx].totalPV = entries[idx].selfPV + entries[idx].groupPV;
            entries[idx].date = document.getElementById('editDate').value;
            entries[idx].consistency = document.getElementById('editConsistency').value;
            entries[idx].meeting = document.getElementById('editMeeting').value;
            entries[idx].newJoiners = document.getElementById('editNewJoiners').value;
            entries[idx].lastModified = new Date().toISOString();
            entries[idx].modifiedBy = loggedInUser.id;
            localStorage.setItem('nfvt_ucd_v2', JSON.stringify(entries));
            updateActivityLog('edit', { old: oldEntry, new: entries[idx] });
            displayData();
            closeEditModal();
            alert(currentLanguage === 'en' ? '‚úÖ Member details updated successfully!' : '‚úÖ ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æ™‡ØÅ‡Æ§‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!');
        }
    }

    function closeEditModal() { document.getElementById('editModal').style.display = 'none'; }

    function displayData() {
        const tableBody = document.getElementById('tableBody');
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        tableBody.innerHTML = '';
        let totalTeamPV = 0;
        let alertCount = 0;
        entries.forEach(item => {
            totalTeamPV += item.totalPV;
            let rowClass = '';
            let statusBadges = '';
            if (item.selfPV < 30) {
                rowClass = 'inactive-warning';
                statusBadges += currentLanguage === 'en'
                    ? '<span style="background:#fee2e2;color:#dc2626;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üö® INACTIVE</span>'
                    : '<span style="background:#fee2e2;color:#dc2626;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üö® ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æ±‡Øç‡Æ±‡Æ§‡ØÅ</span>';
                alertCount++;
            } else if (item.selfPV < 100) {
                rowClass = 'low-pv-warning';
                statusBadges += currentLanguage === 'en'
                    ? '<span style="background:#fed7aa;color:#ea580c;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üìä LOW PV</span>'
                    : '<span style="background:#fed7aa;color:#ea580c;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üìä ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§ PV</span>';
                alertCount++;
            } else {
                rowClass = 'high-pv';
            }
            if (item.groupPV < 2600) {
                if (rowClass === 'high-pv') rowClass = 'low-group-pv';
                statusBadges += currentLanguage === 'en'
                    ? '<span style="background:#fef3c7;color:#92400e;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">‚ö†Ô∏è LOW GRP</span>'
                    : '<span style="background:#fef3c7;color:#92400e;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">‚ö†Ô∏è ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§ ‡Æï‡ØÅ‡Æ¥‡ØÅ</span>';
                alertCount++;
            }
            if (item.consistency === "No") {
                if (rowClass === '') rowClass = 'no-consistency';
                statusBadges += currentLanguage === 'en'
                    ? '<span style="background:#fee2e2;color:#991b1b;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">‚ùå NO 100PV</span>'
                    : '<span style="background:#fee2e2;color:#991b1b;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">‚ùå 100PV ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà</span>';
                alertCount++;
            }
            if (item.meeting === "No") {
                if (rowClass === '' && item.selfPV >= 100) rowClass = 'no-meeting';
                statusBadges += currentLanguage === 'en'
                    ? '<span style="background:#e0e7ff;color:#4f46e5;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üîî MEETING</span>'
                    : '<span style="background:#e0e7ff;color:#4f46e5;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üîî ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡ÆÆ‡Øç</span>';
                alertCount++;
            }
            if (!item.newJoiners || item.newJoiners === 'No') {
                statusBadges += '<span style="background:#f3e8ff;color:#7c3aed;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;margin-right:3px;display:inline-block;margin-bottom:3px;">üë• NO JOINER</span>';
                alertCount++;
            }
            let waMessage = currentLanguage === 'en' ? `Hello ${item.name}! üëã\n\n` : `‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç ${item.name}! üëã\n\n`;
            if (item.selfPV < 30) {
                const needed = 30 - item.selfPV;
                waMessage += currentLanguage === 'en'
                    ? `üö® *URGENT - ID ACTIVATION ALERT*\n\n‚ö†Ô∏è Your ID will become INACTIVE!\n\nüìä Current Self PV: ${item.selfPV}\nüéØ Minimum Required: 30 PV\n‚ö†Ô∏è Need: *${needed} PV*\n\n‚è∞ Complete before month end!\nüìû Contact your upline NOW!\n\n`
                    : `üö® *‡ÆÖ‡Æµ‡Æö‡Æ∞‡ÆÆ‡Øç - ID ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ≤‡Øç ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà*\n\n‚ö†Ô∏è ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ID ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æ±‡Øç‡Æ±‡Æ§‡Ææ‡Æï‡Æø‡Æµ‡Æø‡Æü‡ØÅ‡ÆÆ‡Øç!\n\nüìä ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æö‡Øä‡Æ®‡Øç‡Æ§ PV: ${item.selfPV}\nüéØ ‡Æï‡ØÅ‡Æ±‡Øà‡Æ®‡Øç‡Æ§‡Æ™‡Æü‡Øç‡Æö‡ÆÆ‡Øç: 30 PV\n‚ö†Ô∏è ‡Æ§‡Øá‡Æµ‡Øà: *${needed} PV*\n\n`;
            } else if (item.selfPV < 100) {
                const needed = 100 - item.selfPV;
                const today = new Date(); const dayOfMonth = today.getDate();
                if (dayOfMonth >= 2 && dayOfMonth <= 14) {
                    const daysLeft = 14 - dayOfMonth;
                    waMessage += currentLanguage === 'en'
                        ? `‚è∞ *100PV CONSISTENCY REMINDER*\n\nüìÖ Deadline: Before 14th (${daysLeft} days left)\nüìä Current Self PV: ${item.selfPV}\nüéØ Target: 100 PV\n‚ö†Ô∏è Remaining: *${needed} PV*\n\nüéÅ Complete 100 PV and get *‚Çπ2500* voucher!\n\nüí™ Complete before 14th!\n\n`
                        : `‚è∞ *100PV ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç*\n\n${needed} PV ‡ÆÆ‡ØÄ‡Æ§‡ÆÆ‡Øç!\n\n`;
                } else {
                    waMessage += currentLanguage === 'en' ? `üìä Self PV: ${item.selfPV} - Keep pushing to 100!\n\n` : `üìä PV: ${item.selfPV}\n\n`;
                }
            }
            if (item.groupPV < 2600) {
                const needed = 2600 - item.groupPV;
                waMessage += currentLanguage === 'en'
                    ? `‚ö†Ô∏è *Group PV (PGPV) IMPROVEMENT NEEDED*\n\nCurrent: ${item.groupPV} | Target: 2600 | Need: *${needed} PV*\n\n`
                    : `‚ö†Ô∏è ‡Æï‡ØÅ‡Æ¥‡ØÅ PV ${item.groupPV} - ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ: 2600\n\n`;
            }
            if (item.consistency === "No") { waMessage += currentLanguage === 'en' ? `‚ö†Ô∏è Maintain 100PV consistency!\n\n` : `‚ö†Ô∏è 100PV ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø!\n\n`; }
            if (item.meeting === "No") { waMessage += currentLanguage === 'en' ? `üîî Please attend daily meetings!\n\n` : `üîî ‡Æï‡ØÇ‡Æü‡Øç‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æï‡Æ≤‡Æ®‡Øç‡Æ§‡ØÅ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!\n\n`; }
            if (!item.newJoiners || item.newJoiners === 'No') {
                waMessage += currentLanguage === 'en' 
                    ? `üì° *FOCUS ON DAILY CONFERENCE CALLS WITH UPLINE!*\nBring in new joiners this week for faster growth!\n\n`
                    : `üì° *Upline ‡Æâ‡Æü‡Æ©‡Øç ‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æï‡Ææ‡Æ©‡Øç‡Æ™‡Æ∞‡Æ©‡Øç‡Æ∏‡Øç ‡Æï‡Ææ‡Æ≤‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!*\n‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Øà‡Æï‡Øç‡Æï‡ØÅ ‡Æï‡Æµ‡Æ©‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!\n\n`;
            }
            waMessage += currentLanguage === 'en'
                ? `üìà Stats: Self PV: ${item.selfPV} | Group PV: ${item.groupPV} | Total: ${item.totalPV}\n\nüí™ Team NFVT - Success is yours!`
                : `üìà PV: ${item.selfPV} | ‡Æï‡ØÅ‡Æ¥‡ØÅ: ${item.groupPV} | ‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡ÆÆ‡Øç: ${item.totalPV}\n\nüí™ Team NFVT!`;
            const waLink = `https://wa.me/91${item.mobile}?text=${encodeURIComponent(waMessage)}`;

            const alertBadgeCount = (statusBadges.match(/span/g)||[]).length/2;
            const statusCellStyle = alertBadgeCount >= 3 ? 'position:relative;' : '';
            const statusCellAnim = alertBadgeCount >= 3 ? `<div style="position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(239,68,68,0.08),transparent);animation:scanLine 2s linear infinite;pointer-events:none;"></div>` : '';

            tableBody.innerHTML += `<tr class="${rowClass}">
                <td style="min-width:130px;${statusCellStyle}">${statusCellAnim}${statusBadges||'<span style="color:#10b981;font-weight:800;font-size:13px;">‚úÖ Good</span>'}</td>
                <td><strong style="color:#1e293b;">${item.name}</strong><br><small style="color:#64748b;">${item.distId}</small></td>
                <td><strong>${item.mobile}</strong></td>
                <td><span style="background:#ddd6fe;padding:4px 8px;border-radius:6px;font-size:11px;font-weight:700;color:#5b21b6;">${item.level}</span></td>
                <td><strong style="color:${item.selfPV>=100?'#059669':(item.selfPV>=30?'#f59e0b':'#dc2626')};">${item.selfPV}</strong></td>
                <td><strong style="color:${item.groupPV>=2600?'#059669':'#f59e0b'};">${item.groupPV}</strong></td>
                <td><strong style="font-size:15px;color:#1e293b;">${item.totalPV}</strong></td>
                <td>${item.date}</td>
                <td><span style="background:${item.consistency==='Yes'?'#dcfce7':'#fee2e2'};color:${item.consistency==='Yes'?'#166534':'#991b1b'};padding:4px 8px;border-radius:6px;font-size:11px;font-weight:700;">${item.consistency}</span></td>
                <td><span style="background:${item.meeting==='Yes'?'#dbeafe':'#fef3c7'};color:${item.meeting==='Yes'?'#1e40af':'#92400e'};padding:4px 8px;border-radius:6px;font-size:11px;font-weight:700;">${item.meeting}</span></td>
                <td><span style="background:${(item.newJoiners||'No')==='Yes'?'#dcfce7':'#f3e8ff'};color:${(item.newJoiners||'No')==='Yes'?'#166534':'#7c3aed'};padding:4px 8px;border-radius:6px;font-size:11px;font-weight:800;">${(item.newJoiners||'No')==='Yes'?'‚úÖ Yes':'üë• No'}</span></td>
                <td>
                    <button class="edit-btn" onclick="editEntry(${item.id})">‚úèÔ∏è</button>
                    <button class="delete-btn" onclick="deleteEntry(${item.id})">‚ùå</button>
                </td>
                <td><a href="${waLink}" target="_blank" class="wa-link">üì± WA</a></td>
            </tr>`;
        });

        const statsEl = document.getElementById('totalStats');
        const statsText = currentLanguage === 'en'
            ? `Total Team PV: ${totalTeamPV.toFixed(2)} | Members: ${entries.length} | üîî Alerts: ${alertCount}`
            : `‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ ‡Æï‡ØÅ‡Æ¥‡ØÅ PV: ${totalTeamPV.toFixed(2)} | ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡Øç: ${entries.length} | üîî ‡Æé‡Æö‡Øç‡Æö‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡Æï‡Æ≥‡Øç: ${alertCount}`;
        statsEl.querySelector('.lang-text').textContent = statsText;
        if (alertCount > 0) {
            statsEl.classList.add('has-alerts');
        } else {
            statsEl.classList.remove('has-alerts');
        }
    }

    function deleteEntry(id) {
        const confirmMsg = currentLanguage === 'en' ? "‚ö†Ô∏è Delete this member?" : "‚ö†Ô∏è ‡Æá‡Æ®‡Øç‡Æ§ ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øà ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡Æµ‡Ææ?";
        if(confirm(confirmMsg)) {
            let entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
            let trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
            const idx = entries.findIndex(e => e.id === id);
            if (idx > -1) {
                trash.push(entries[idx]);
                updateActivityLog('delete', entries[idx]);
                entries.splice(idx, 1);
                localStorage.setItem('nfvt_ucd_v2', JSON.stringify(entries));
                localStorage.setItem('nfvt_trash', JSON.stringify(trash));
                displayData();
            }
        }
    }

    /* ===== FIX 3: SMART REPORT ANALYTICS ENGINE ===== */
    function buildReportAnalysis(entries) {
        const total = entries.length;
        if (total === 0) return '<p style="color:#64748b;">No members added yet.</p>';

        // Calculate all parameters
        const active       = entries.filter(e => e.selfPV >= 30).length;
        const inactive     = entries.filter(e => e.selfPV < 30).length;
        const hit100       = entries.filter(e => e.selfPV >= 100).length;
        const low100       = entries.filter(e => e.selfPV >= 30 && e.selfPV < 100).length;
        const consistency  = entries.filter(e => e.consistency === 'Yes').length;
        const noConsist    = entries.filter(e => e.consistency === 'No').length;
        const meetingYes   = entries.filter(e => e.meeting === 'Yes').length;
        const meetingNo    = entries.filter(e => e.meeting === 'No').length;
        const withJoiners  = entries.filter(e => e.newJoiners === 'Yes').length;
        const noJoiners    = entries.filter(e => !e.newJoiners || e.newJoiners === 'No').length;
        const goodGroupPV  = entries.filter(e => e.groupPV >= 2600).length;
        const lowGroupPV   = entries.filter(e => e.groupPV < 2600).length;

        const pct = (n) => total > 0 ? Math.round((n/total)*100) : 0;

        // Grade helper
        const grade = (p) => {
            if (p >= 80) return { label: 'üü¢ GOOD', color: '#059669', bg: '#dcfce7' };
            if (p >= 50) return { label: 'üü° AVERAGE', color: '#b45309', bg: '#fef3c7' };
            return { label: 'üî¥ NEEDS FOCUS', color: '#dc2626', bg: '#fee2e2' };
        };

        // Progress bar html
        const bar = (pct, color) => `
            <div style="background:#e2e8f0;border-radius:99px;height:10px;margin:5px 0 0 0;overflow:hidden;">
                <div style="width:${pct}%;height:100%;background:${color};border-radius:99px;transition:width 1s;"></div>
            </div>`;

        // Metric card html
        const card = (icon, title, done, total_, pctVal, note) => {
            const g = grade(pctVal);
            return `
            <div style="background:${g.bg};border:1.5px solid ${g.color}22;border-radius:14px;padding:14px 16px;margin-bottom:12px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:3px;">
                    <span style="font-size:14px;font-weight:800;color:#1e293b;">${icon} ${title}</span>
                    <span style="background:${g.bg};color:${g.color};border:1.5px solid ${g.color};padding:3px 10px;border-radius:20px;font-size:11px;font-weight:900;">${g.label}</span>
                </div>
                <div style="font-size:22px;font-weight:900;color:${g.color};">${pctVal}% <span style="font-size:13px;font-weight:600;color:#64748b;">(${done} of ${total_} members)</span></div>
                ${bar(pctVal, g.color)}
                <div style="font-size:12px;color:#475569;margin-top:7px;">${note}</div>
            </div>`;
        };

        // Identify what to focus on (sorted by worst first)
        const params = [
            { name: 'Recruitment (New Joiners)', pct: pct(withJoiners), bad: noJoiners, advice: 'Focus on daily upline conference calls & sharing business opportunity with 5+ prospects daily.' },
            { name: '100PV Consistency', pct: pct(consistency), bad: noConsist, advice: 'Remind members to order before 14th. Consistency gives ‚Çπ2500 voucher benefit ‚Äî don\'t miss it!' },
            { name: 'Meeting Attendance', pct: pct(meetingYes), bad: meetingNo, advice: 'Push for 6PM & 8PM daily meetings. Members who attend meetings grow 3x faster.' },
            { name: 'Active IDs (Self PV ‚â• 30)', pct: pct(active), bad: inactive, advice: 'Any ID below 30 PV will go inactive. Urgent action needed before month end.' },
            { name: 'Self PV ‚â• 100', pct: pct(hit100), bad: low100, advice: 'Members with 100PV earn consistency voucher. Encourage product usage from their own family first.' },
            { name: 'Group PV ‚â• 2600', pct: pct(goodGroupPV), bad: lowGroupPV, advice: 'Low Group PV means weak downline. Focus on helping downlines hit their individual PV.' },
        ].sort((a,b) => a.pct - b.pct);

        // Overall team health score
        const overallScore = Math.round(
            (pct(active)*0.2 + pct(hit100)*0.2 + pct(consistency)*0.2 + pct(meetingYes)*0.15 + pct(withJoiners)*0.15 + pct(goodGroupPV)*0.1)
        );
        const overallGrade = overallScore >= 75 ? { emoji:'üèÜ', label:'Excellent', color:'#059669' } 
                           : overallScore >= 50 ? { emoji:'‚ö°', label:'Average', color:'#b45309' } 
                           : { emoji:'üö®', label:'Needs Improvement', color:'#dc2626' };

        // Worst parameters paragraph (the key insight section)
        const worstParam = params[0];
        const focusParagraph = `
        <div style="background:linear-gradient(135deg,#1e293b,#334155);color:white;border-radius:16px;padding:20px;margin-bottom:20px;">
            <div style="font-size:16px;font-weight:900;margin-bottom:10px;">üîç Team Analysis Summary</div>
            <div style="font-size:13px;line-height:1.9;color:rgba(255,255,255,0.85);">
                Out of <strong style="color:#fbbf24;">${total} members</strong>, your team scored <strong style="color:${overallGrade.color};font-size:16px;"> ${overallScore}% overall</strong> ${overallGrade.emoji} ‚Äî <em>${overallGrade.label}</em>.<br><br>
                ${params.filter(p=>p.pct<50).length > 0
                    ? `<strong style="color:#f87171;">‚ö†Ô∏è Critical Areas:</strong> ${params.filter(p=>p.pct<50).map(p=>`<span style="background:rgba(239,68,68,0.2);padding:2px 8px;border-radius:6px;">${p.name} (${p.pct}%)</span>`).join(' ¬∑ ')}<br><br>`
                    : `<strong style="color:#6ee7b7;">‚úÖ All parameters are above 50% ‚Äî keep pushing higher!</strong><br><br>`
                }
                ${params.filter(p=>p.pct>=80).length > 0
                    ? `<strong style="color:#6ee7b7;">‚úÖ Doing Well:</strong> ${params.filter(p=>p.pct>=80).map(p=>`<span style="background:rgba(16,185,129,0.2);padding:2px 8px;border-radius:6px;">${p.name} (${p.pct}%)</span>`).join(' ¬∑ ')}<br><br>`
                    : ''
                }
                <strong style="color:#fbbf24;">üéØ #1 Priority to fix right now:</strong> <span style="color:white;">${worstParam.name} is only <strong style="color:#f87171;">${worstParam.pct}%</strong> (${worstParam.bad} members struggling).</span><br>
                <span style="color:rgba(255,255,255,0.7);font-size:12px;">‚Üí ${worstParam.advice}</span>
            </div>
        </div>`;

        // Parameter-by-parameter cards
        const paramCards = params.map(p => {
            const bad = p.bad;
            const g = grade(p.pct);
            return `
            <div style="background:${g.bg};border:1.5px solid ${g.color}33;border-radius:12px;padding:12px 15px;margin-bottom:10px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <span style="font-weight:800;font-size:13px;color:#1e293b;">${p.name}</span>
                    <span style="color:${g.color};font-weight:900;font-size:16px;">${p.pct}%</span>
                </div>
                ${bar(p.pct, g.color)}
                <div style="margin-top:7px;font-size:11.5px;color:#374151;">
                    ${bad > 0 ? `<span style="color:${g.color};font-weight:700;">${bad} member${bad>1?'s':''} need attention. </span>` : '<span style="color:#059669;font-weight:700;">All members on track! </span>'}
                    ${p.advice}
                </div>
            </div>`;
        }).join('');

        // Members with best performance
        const topMembers = [...entries].sort((a,b)=>b.totalPV-a.totalPV).slice(0,3);
        const topList = topMembers.map((m,i)=>`<div style="padding:6px 0;border-bottom:1px solid #f1f5f9;font-size:13px;"><strong>${['ü•á','ü•à','ü•â'][i]} ${m.name}</strong> <span style="color:#64748b;">(${m.distId})</span> ‚Äî Total PV: <strong style="color:#059669;">${m.totalPV}</strong></div>`).join('');

        // Members needing most attention
        const needsHelp = entries.filter(e => e.selfPV < 100 || e.consistency === 'No' || e.meeting === 'No' || !e.newJoiners || e.newJoiners === 'No')
            .sort((a,b)=>{
                const score = e => (e.selfPV<30?4:e.selfPV<100?2:0) + (e.consistency==='No'?1:0) + (e.meeting==='No'?1:0) + (!e.newJoiners||e.newJoiners==='No'?1:0);
                return score(b)-score(a);
            }).slice(0,5);
        const needsList = needsHelp.map(m=>{
            const issues = [];
            if(m.selfPV<30) issues.push('üö® Inactive ID');
            else if(m.selfPV<100) issues.push('üìä Low Self PV');
            if(m.consistency==='No') issues.push('‚ùå No 100PV');
            if(m.meeting==='No') issues.push('üîî Missed Meeting');
            if(!m.newJoiners||m.newJoiners==='No') issues.push('üë• No Joiner');
            if(m.groupPV<2600) issues.push('‚ö†Ô∏è Low Group PV');
            return `<div style="padding:6px 0;border-bottom:1px solid #fee2e2;font-size:12px;"><strong>${m.name}</strong> <span style="color:#94a3b8;">(${m.distId})</span><br><span style="color:#dc2626;">${issues.join(' ¬∑ ')}</span></div>`;
        }).join('');

        return `
            ${focusParagraph}
            <div style="font-size:15px;font-weight:900;color:#1e293b;margin:18px 0 10px;">üìä Parameter-wise Performance</div>
            ${paramCards}
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:18px;">
                <div style="background:#f0fdf4;border:1.5px solid #bbf7d0;border-radius:14px;padding:16px;">
                    <div style="font-weight:900;color:#166534;margin-bottom:10px;font-size:13px;">üèÜ Top Performers (by Total PV)</div>
                    ${topList || '<div style="color:#94a3b8;font-size:12px;">No data yet</div>'}
                </div>
                <div style="background:#fef2f2;border:1.5px solid #fecaca;border-radius:14px;padding:16px;">
                    <div style="font-weight:900;color:#991b1b;margin-bottom:10px;font-size:13px;">üö® Members Needing Most Attention</div>
                    ${needsList || '<div style="color:#94a3b8;font-size:12px;">All members are doing well!</div>'}
                </div>
            </div>
            <div style="background:#fffbeb;border:1.5px solid #fde68a;border-radius:12px;padding:12px 16px;margin-top:16px;font-size:12px;color:#78350f;">
                <strong>üí° Key Reminder:</strong> The more frequently you update data (daily edits), the more accurately this report reflects your team's real-time progress. Each edit is tracked ‚Äî consistent daily updates = better insights!
            </div>`;
    }

    function showReports() {
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const now = new Date();
        const currentMonth = now.getMonth(); const currentYear = now.getFullYear();
        const monthStart = new Date(currentYear, currentMonth, 2);
        const monthEnd = new Date(currentYear, currentMonth + 1, 2);
        const monthlyEntries = entries.filter(e => { const d = new Date(e.date); return d >= monthStart && d < monthEnd; });
        const dailyData = {};
        entries.forEach(e => { if (!dailyData[e.date]) dailyData[e.date] = []; dailyData[e.date].push(e); });
        let daily8PercentCount = 0;
        Object.keys(dailyData).forEach(date => {
            const dayTotal = dailyData[date].reduce((sum, e) => sum + e.totalPV, 0);
            if (dayTotal >= entries.length * dailyTargetPercentage) daily8PercentCount++;
        });
        const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];

        const reportHTML = `
        <div style="text-align:left;">
            <div style="background:linear-gradient(135deg,#667eea,#764ba2);color:white;border-radius:14px;padding:18px;margin-bottom:20px;text-align:center;">
                <div style="font-family:'Playfair Display',serif;font-size:20px;font-weight:900;">üìä Team NFVT Performance Report</div>
                <div style="font-size:12px;opacity:0.85;margin-top:4px;">${months[currentMonth]} ${currentYear} ¬∑ Generated by ${loggedInUser.name}</div>
                <div style="font-size:13px;margin-top:8px;">Total Members: <strong>${entries.length}</strong> ¬∑ Monthly Entries: <strong>${monthlyEntries.length}</strong> ¬∑ Team PV: <strong>${entries.reduce((s,e)=>s+e.totalPV,0).toFixed(1)}</strong></div>
                <div style="font-size:12px;margin-top:6px;opacity:0.85;">Daily ${dailyTargetPercentage}% target achieved on: <strong>${daily8PercentCount} days</strong> 
                <button onclick="updateDailyTarget()" style="background:rgba(255,255,255,0.2);color:white;border:1px solid rgba(255,255,255,0.4);padding:3px 10px;border-radius:6px;cursor:pointer;font-size:11px;margin-left:8px;font-weight:700;">‚öôÔ∏è Update</button></div>
            </div>
            ${buildReportAnalysis(entries)}
        </div>`;

        document.getElementById('reportsContent').innerHTML = reportHTML;
        document.getElementById('reportsModal').style.display = 'flex';
    }

    function updateDailyTarget() {
        const newTarget = prompt(currentLanguage === 'en' ? `Enter new daily target % (current: ${dailyTargetPercentage}%):` : `‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ (${dailyTargetPercentage}%):`);
        if (newTarget && !isNaN(newTarget) && newTarget > 0 && newTarget <= 100) {
            dailyTargetPercentage = parseFloat(newTarget);
            localStorage.setItem('dailyTargetPercentage', dailyTargetPercentage);
            alert(currentLanguage === 'en' ? `‚úÖ Target updated to ${dailyTargetPercentage}%` : `‚úÖ ‡Æá‡Æ≤‡Æï‡Øç‡Æï‡ØÅ ${dailyTargetPercentage}%`);
            showReports();
        }
    }

    function closeReportsModal() { document.getElementById('reportsModal').style.display = 'none'; }

    /* ===== FIX 3: SMART PDF REPORT with Analysis ===== */
    function generateSmartAnalysisText(entries) {
        const total = entries.length;
        if (total === 0) return [];

        const pct = (n) => total > 0 ? Math.round((n/total)*100) : 0;
        const active       = entries.filter(e => e.selfPV >= 30).length;
        const inactive     = entries.filter(e => e.selfPV < 30).length;
        const hit100       = entries.filter(e => e.selfPV >= 100).length;
        const consistency  = entries.filter(e => e.consistency === 'Yes').length;
        const noConsist    = entries.filter(e => e.consistency === 'No').length;
        const meetingYes   = entries.filter(e => e.meeting === 'Yes').length;
        const meetingNo    = entries.filter(e => e.meeting === 'No').length;
        const withJoiners  = entries.filter(e => e.newJoiners === 'Yes').length;
        const noJoiners    = entries.filter(e => !e.newJoiners || e.newJoiners === 'No').length;
        const goodGroupPV  = entries.filter(e => e.groupPV >= 2600).length;
        const lowGroupPV   = entries.filter(e => e.groupPV < 2600).length;

        const overallScore = Math.round(
            (pct(active)*0.2 + pct(hit100)*0.2 + pct(consistency)*0.2 + pct(meetingYes)*0.15 + pct(withJoiners)*0.15 + pct(goodGroupPV)*0.1)
        );
        const overallLabel = overallScore >= 75 ? 'EXCELLENT' : overallScore >= 50 ? 'AVERAGE' : 'NEEDS IMPROVEMENT';

        const params = [
            { name: 'Active IDs (Self PV >= 30)', done: active, bad: inactive, pct: pct(active), advice: 'Any ID below 30 PV will go inactive. Urgent action needed before month end.' },
            { name: 'Self PV >= 100',             done: hit100, bad: total-hit100, pct: pct(hit100), advice: 'Encourage product usage from own family first. Consistency voucher ‚Çπ2500 benefit.' },
            { name: '100PV Consistency (CNC)',    done: consistency, bad: noConsist, pct: pct(consistency), advice: 'Remind members to order before 14th every cycle.' },
            { name: 'Meeting Attendance',          done: meetingYes, bad: meetingNo, pct: pct(meetingYes), advice: 'Members who attend meetings daily grow 3x faster.' },
            { name: 'Group PV >= 2600 (PGPV)',    done: goodGroupPV, bad: lowGroupPV, pct: pct(goodGroupPV), advice: 'Focus on helping downlines hit their individual PV targets.' },
            { name: 'Recruitment (New Joiners)',   done: withJoiners, bad: noJoiners, pct: pct(withJoiners), advice: 'Daily conference calls with upline. Share business with 5+ prospects daily.' },
        ].sort((a,b) => a.pct - b.pct);

        const lines = [];
        lines.push({ text: `TEAM HEALTH SCORE: ${overallScore}% ‚Äî ${overallLabel}`, style: 'header' });
        lines.push({ text: `Analysis of ${total} members:`, style: 'normal' });
        lines.push({ text: '', style: 'spacer' });

        params.forEach(p => {
            const status = p.pct >= 80 ? '‚úì GOOD' : p.pct >= 50 ? '~ AVERAGE' : '‚úó NEEDS FOCUS';
            lines.push({ text: `${status}  |  ${p.name}: ${p.pct}% (${p.done} done, ${p.bad} need attention)`, style: p.pct < 50 ? 'alert' : p.pct >= 80 ? 'good' : 'warn' });
            if (p.bad > 0) {
                lines.push({ text: `   ‚Üí Action: ${p.advice}`, style: 'advice' });
            }
            lines.push({ text: '', style: 'spacer' });
        });

        lines.push({ text: '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', style: 'normal' });
        lines.push({ text: 'PRIORITY FOCUS:', style: 'header' });
        const worst = params[0];
        lines.push({ text: `#1 Fix: "${worst.name}" is at only ${worst.pct}% ‚Äî ${worst.bad} members need follow-up.`, style: 'alert' });
        lines.push({ text: `   ${worst.advice}`, style: 'advice' });
        const critical = params.filter(p => p.pct < 50);
        if (critical.length > 1) {
            lines.push({ text: `Other critical areas: ${critical.slice(1).map(p=>`${p.name} (${p.pct}%)`).join(', ')}`, style: 'warn' });
        }
        const good = params.filter(p => p.pct >= 80);
        if (good.length > 0) {
            lines.push({ text: `Well performing: ${good.map(p=>`${p.name} (${p.pct}%)`).join(', ')}`, style: 'good' });
        }

        return lines;
    }

    function downloadMonthlyReport() {
        const isTa = currentLanguage === 'ta';
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const now = new Date();
        const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        const monthsTa = ['Janairi','Pebravari','Maarch','Eipral','May','Juni','Julai','Agast','September','Aktoobar','Navambar','Tisambar'];
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Header
        doc.setFillColor(30, 41, 59);
        doc.rect(0, 0, 210, 38, 'F');
        doc.setFontSize(16); doc.setTextColor(252, 246, 186); doc.setFont(undefined, 'bold');
        doc.text(isTa ? 'NFVT Kuzhu Maadhaantha Seyal Arikkai' : 'NFVT Team Monthly Performance Report', 105, 14, { align: 'center' });
        doc.setFontSize(9); doc.setTextColor(180, 200, 220); doc.setFont(undefined, 'normal');
        const monthLabel = (isTa ? monthsTa : months)[now.getMonth()] + ' ' + now.getFullYear();
        doc.text(`${monthLabel}  ¬∑  ${isTa?'Aayvalar':'Generated by'}: ${loggedInUser.name} (ID: ${loggedInUser.id})  ¬∑  ${now.toLocaleDateString()}`, 105, 23, { align: 'center' });
        const totalPV = entries.reduce((sum,e)=>sum+e.totalPV,0);
        doc.text(`${isTa?'Uruppinargal':'Total Members'}: ${entries.length}  |  ${isTa?'Kuzhu PV':'Team PV'}: ${totalPV.toFixed(1)}  |  ${isTa?'Naal':'Date'}: ${now.toLocaleString()}`, 105, 31, { align: 'center' });

        // Analysis section
        let y = 45;
        doc.setFontSize(13); doc.setTextColor(30, 41, 59); doc.setFont(undefined, 'bold');
        doc.text(isTa ? 'KUZHU SEYAL AAYVUMURAI' : 'TEAM PERFORMANCE ANALYSIS', 14, y); y += 8;
        doc.setDrawColor(191, 149, 63);
        doc.setLineWidth(0.5);
        doc.line(14, y, 196, y); y += 6;

        const analysisLines = generateSmartAnalysisText(entries);
        analysisLines.forEach(line => {
            if (line.style === 'spacer') { y += 3; return; }
            if (y > 270) { doc.addPage(); y = 20; }
            if (line.style === 'header') {
                doc.setFontSize(11); doc.setTextColor(30, 41, 59);
                doc.setFont(undefined, 'bold');
            } else if (line.style === 'alert') {
                doc.setFontSize(9); doc.setTextColor(185, 28, 28);
                doc.setFont(undefined, 'bold');
            } else if (line.style === 'good') {
                doc.setFontSize(9); doc.setTextColor(5, 150, 105);
                doc.setFont(undefined, 'bold');
            } else if (line.style === 'warn') {
                doc.setFontSize(9); doc.setTextColor(146, 64, 14);
                doc.setFont(undefined, 'normal');
            } else if (line.style === 'advice') {
                doc.setFontSize(8); doc.setTextColor(71, 85, 105);
                doc.setFont(undefined, 'italic');
            } else {
                doc.setFontSize(9); doc.setTextColor(51, 65, 85);
                doc.setFont(undefined, 'normal');
            }
            const wrapped = doc.splitTextToSize(line.text, 180);
            doc.text(wrapped, 14, y);
            y += wrapped.length * 5 + 1;
        });

        // Table
        y += 8;
        if (y > 240) { doc.addPage(); y = 20; }
        doc.setFontSize(12); doc.setTextColor(30, 41, 59); doc.setFont(undefined, 'bold');
        doc.text(isTa ? 'URUPPINAR VIVARANGAL' : 'MEMBER DATA TABLE', 14, y); y += 5;
        const rows = entries.map(e=>[e.name,e.distId,e.selfPV,e.groupPV,e.totalPV,e.consistency,e.meeting,e.newJoiners||'No',e.date]);
        doc.autoTable({
            head:[[
                isTa?'Peyar':'Name',
                'ID',
                isTa?'Sontha PV':'Self PV',
                isTa?'Kuzhu PV':'Group PV',
                isTa?'Mottam':'Total',
                isTa?'100PV':'100PV',
                isTa?'Kootam':'Meeting',
                isTa?'Searkkai':'Joiners',
                isTa?'Naal':'Date'
            ]],
            body: rows,
            startY: y+2,
            styles:{ fontSize:7 },
            headStyles:{ fillColor:[30,41,59], textColor:[252,246,186] },
            alternateRowStyles: { fillColor: [248,250,252] },
            didParseCell: function(data) {
                if (data.section === 'body') {
                    const selfPV = parseFloat(rows[data.row.index][2]);
                    if (selfPV < 30) { data.cell.styles.fillColor = [254,202,202]; }
                    else if (selfPV < 100) { data.cell.styles.fillColor = [254,215,170]; }
                    else { data.cell.styles.fillColor = [209,250,229]; }
                }
            }
        });

        doc.save(`NFVT_Monthly_Report_${loggedInUser.id}_${now.toISOString().split('T')[0]}.pdf`);
    }

    function downloadPDF() {
        // ‚îÄ‚îÄ language strings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const isTa = currentLanguage === 'ta';
        const T = {
            title:       isTa ? 'NFVT Kuzhu Followup Arikkai' : 'NFVT Team Followup Report',
            dailyReport: isTa ? 'THINASARI SEYAL ARIKKAI' : 'DAILY ACTIVITY REPORT',
            by:          isTa ? 'Aayvalar' : 'By',
            members:     isTa ? 'Uruppinargal' : 'Members',
            teamPV:      isTa ? 'Kuzhu PV' : 'Team PV',
            date:        isTa ? 'Naal' : 'Date',
            summaryHdr:  isTa ? '% AAYVUKKU KATTAMAI (SUNNIYAM ARIKKAI)' : '% PERFORMANCE SUMMARY (MINIMAL REPORT)',
            parameter:   isTa ? 'Alavukol' : 'Parameter',
            count:       isTa ? 'Ennikkai' : 'Count',
            pctLbl:      isTa ? 'Sathagam' : 'Percentage',
            status:      isTa ? 'Nilai' : 'Status',
            good:        isTa ? 'NALLADU' : 'GOOD',
            avg:         isTa ? 'SARAASARI' : 'AVERAGE',
            focus:       isTa ? 'KANIVIL VECHUKOLLAVUM' : 'NEEDS FOCUS',
            selfPVparam: isTa ? 'Sontha PV >= 100' : 'Self PV >= 100',
            consist:     isTa ? '100PV Thodarchi (CNC)' : '100PV Consistency (CNC)',
            meeting:     isTa ? 'Kootam (Thinasari Thiruthappatta)' : 'Meeting (Daily Edited Yes)',
            recruit:     isTa ? 'Puthiya Searkkai (Thinasari Thiruthappatta)' : 'Recruitment / New Joiners (Daily Edited Yes)',
            memberHdr:   isTa ? 'URUPPINAR VIVARANGAL' : 'MEMBER DATA',
            noteHdr:     isTa ? 'KURIPPUGAL' : 'NOTES',
            note1:       isTa ? '* Meeting & Recruitment % = Thinasari Yes endru thiruthappadavillaiyenil 0%' : '* Meeting % & Recruitment % = 0% if not edited to Yes today',
            note2:       isTa ? '* Uruppinargal 10-kku kural irundhal % kuraikka padugindradhu' : '* If total members < 10, % score is reduced proportionally',
            note3:       isTa ? '* Ithuvare serkkapadda uruppinargalin thagaval kolvappadugindradhu' : '* Data reflects all entries recorded so far',
            memberCount: isTa ? 'Uruppinargal' : 'Members',
        };

        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const now = new Date();
        const todayStr = now.toISOString().split('T')[0];
        const total = entries.length;
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // ‚îÄ‚îÄ Calculate % metrics ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Base % from all entries
        const hit100     = entries.filter(e => e.selfPV >= 100).length;
        const consist    = entries.filter(e => e.consistency === 'Yes').length;
        // Meeting & Recruitment: only count today's Yes edits (last-edited date = today)
        const todayEdited = entries.filter(e => {
            const d = (e.lastModified || e.timestamp || e.date || '').substring(0,10);
            return d === todayStr;
        });
        const meetingToday   = todayEdited.filter(e => e.meeting === 'Yes').length;
        const recruitToday   = todayEdited.filter(e => e.newJoiners === 'Yes').length;

        // Raw percentages
        const rawPV       = total > 0 ? Math.round((hit100 / total) * 100) : 0;
        const rawConsist  = total > 0 ? Math.round((consist / total) * 100) : 0;
        const rawMeeting  = total > 0 ? Math.round((meetingToday / total) * 100) : 0;
        const rawRecruit  = total > 0 ? Math.round((recruitToday / total) * 100) : 0;

        // Member count penalty: if < 10 members, reduce by (10-total)/10 factor
        const countFactor = total >= 10 ? 1 : total / 10;
        const pv       = Math.round(rawPV * countFactor);
        const cn       = Math.round(rawConsist * countFactor);
        const mt       = Math.round(rawMeeting * countFactor);
        const rc       = Math.round(rawRecruit * countFactor);
        const overall  = Math.round((pv * 0.3 + cn * 0.3 + mt * 0.2 + rc * 0.2));
        const overallLabel = overall >= 75 ? (isTa ? 'SIRAPPANA NILAI' : 'EXCELLENT') 
                           : overall >= 50 ? (isTa ? 'SARAASARI' : 'AVERAGE') 
                           : (isTa ? 'MEEMPADUPPU THEVAIPPADUGINDRADHU' : 'NEEDS IMPROVEMENT');

        const gradeColor = (p) => p >= 75 ? [5,150,105] : p >= 50 ? [180,100,0] : [185,28,28];
        const gradeText  = (p) => p >= 75 ? T.good : p >= 50 ? T.avg : T.focus;

        // ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        doc.setFillColor(30, 41, 59);
        doc.rect(0, 0, 210, 40, 'F');
        doc.setFontSize(15); doc.setTextColor(252, 246, 186); doc.setFont(undefined, 'bold');
        doc.text(T.title, 105, 13, { align: 'center' });
        doc.setFontSize(9); doc.setTextColor(200, 215, 235); doc.setFont(undefined, 'normal');
        doc.text(`${T.by}: ${loggedInUser.name} (ID: ${loggedInUser.id})`, 105, 21, { align: 'center' });
        const totalPV = entries.reduce((s,e)=>s+e.totalPV,0);
        doc.text(`${T.members}: ${total}  |  ${T.teamPV}: ${totalPV.toFixed(1)}  |  ${T.date}: ${now.toLocaleDateString()}`, 105, 29, { align: 'center' });
        // Member count penalty note if applicable
        if (total < 10) {
            doc.setFontSize(7); doc.setTextColor(255,200,80);
            doc.text(`(${isTa ? `Uruppinargal ${total}/10 ‚Äî % kuraikka padugindradhu` : `Members ${total}/10 ‚Äî % reduced due to low member count`})`, 105, 36, { align: 'center' });
        }

        // ‚îÄ‚îÄ Section: % Summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let y = 47;
        doc.setFontSize(11); doc.setTextColor(30, 41, 59); doc.setFont(undefined, 'bold');
        doc.text(T.summaryHdr, 14, y); y += 4;
        doc.setDrawColor(191, 149, 63); doc.setLineWidth(0.6);
        doc.line(14, y, 196, y); y += 5;

        // Overall score box
        const [gr,gg,gb] = gradeColor(overall);
        doc.setFillColor(gr,gg,gb);
        doc.roundedRect(14, y, 182, 14, 3, 3, 'F');
        doc.setFontSize(12); doc.setTextColor(255,255,255); doc.setFont(undefined, 'bold');
        doc.text(`${isTa?'Olverum Kuzhu Nilai':'Overall Team Score'}: ${overall}%  ‚Äî  ${overallLabel}`, 105, y+9, { align: 'center' });
        y += 20;

        // 4 parameter rows
        const params = [
            { label: T.selfPVparam, raw: rawPV, adj: pv,  count: hit100 },
            { label: T.consist,     raw: rawConsist, adj: cn, count: consist },
            { label: T.meeting,     raw: rawMeeting, adj: mt, count: meetingToday },
            { label: T.recruit,     raw: rawRecruit, adj: rc, count: recruitToday },
        ];

        params.forEach((p, i) => {
            const [r,g,b] = gradeColor(p.adj);
            const isEven = i % 2 === 0;
            doc.setFillColor(isEven ? 248 : 255, isEven ? 250 : 255, isEven ? 252 : 255);
            doc.rect(14, y-1, 182, 14, 'F');
            doc.setFontSize(9); doc.setTextColor(30,41,59); doc.setFont(undefined, 'bold');
            doc.text(p.label, 16, y+6);
            // % bar (right side)
            const barX = 120; const barW = 50; const barH = 5;
            doc.setFillColor(220,220,220);
            doc.roundedRect(barX, y+3, barW, barH, 2, 2, 'F');
            doc.setFillColor(r,g,b);
            doc.roundedRect(barX, y+3, Math.max(1, barW * p.adj / 100), barH, 2, 2, 'F');
            // % number
            doc.setFontSize(10); doc.setTextColor(r,g,b); doc.setFont(undefined, 'bold');
            doc.text(`${p.adj}%`, 174, y+7.5, { align: 'right' });
            // count
            doc.setFontSize(7); doc.setTextColor(100,116,139); doc.setFont(undefined, 'normal');
            doc.text(`(${p.count}/${total}${total<10?` ¬∑ -penalty`:''}${p.raw !== p.adj ? ` ¬∑ raw ${p.raw}%`:''})`  , 176, y+7.5);
            // status tag
            doc.setFontSize(7); doc.setTextColor(r,g,b); doc.setFont(undefined, 'bold');
            doc.text(gradeText(p.adj), 16, y+12);
            y += 16;
        });

        // ‚îÄ‚îÄ Notes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        y += 4;
        doc.setFontSize(8); doc.setTextColor(71,85,105); doc.setFont(undefined, 'italic');
        doc.text(T.noteHdr + ':', 14, y); y += 5;
        doc.setFontSize(7);
        [T.note1, T.note2, T.note3].forEach(n => {
            const wrapped = doc.splitTextToSize(n, 182);
            doc.text(wrapped, 14, y);
            y += wrapped.length * 4 + 1;
        });

        // ‚îÄ‚îÄ Divider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        y += 4;
        doc.setDrawColor(191, 149, 63); doc.setLineWidth(0.4);
        doc.line(14, y, 196, y); y += 6;

        // ‚îÄ‚îÄ Member Data Table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        if (y > 240) { doc.addPage(); y = 20; }
        doc.setFontSize(10); doc.setTextColor(30, 41, 59); doc.setFont(undefined, 'bold');
        doc.text(T.memberHdr, 14, y); y += 3;

        const rows = entries.map(e => [
            e.name, e.distId,
            e.selfPV,
            e.selfPV >= 100 ? (isTa ? 'NALLADU' : 'GOOD') : (isTa ? 'KURAVE' : 'LOW'),
            e.consistency === 'Yes' ? (isTa ? 'AAME' : 'YES') : (isTa ? 'ILLAI' : 'NO'),
            e.meeting === 'Yes' ? (isTa ? 'AAME' : 'YES') : (isTa ? 'ILLAI' : 'NO'),
            (e.newJoiners || 'No') === 'Yes' ? (isTa ? 'AAME' : 'YES') : (isTa ? 'ILLAI' : 'NO'),
            e.date
        ]);

        doc.autoTable({
            head: [[
                isTa ? 'Peyar' : 'Name',
                'ID',
                isTa ? 'Sontha PV' : 'Self PV',
                isTa ? 'PV Nilai' : 'PV Status',
                isTa ? '100PV' : '100PV',
                isTa ? 'Kootam' : 'Meeting',
                isTa ? 'Searkkai' : 'Joiner',
                isTa ? 'Naal' : 'Date'
            ]],
            body: rows,
            startY: y + 3,
            styles: { fontSize: 7.5 },
            headStyles: { fillColor: [30,41,59], textColor: [252,246,186], fontStyle: 'bold' },
            alternateRowStyles: { fillColor: [248,250,252] },
            didParseCell: function(data) {
                if (data.section === 'body' && data.column.index === 2) {
                    const v = parseFloat(rows[data.row.index][2]);
                    if (v < 30)        data.cell.styles.fillColor = [254,202,202];
                    else if (v < 100)  data.cell.styles.fillColor = [254,215,170];
                    else               data.cell.styles.fillColor = [209,250,229];
                }
                if (data.section === 'body' && data.column.index === 4) {
                    if (rows[data.row.index][4] === 'NO' || rows[data.row.index][4] === 'ILLAI')
                        data.cell.styles.fillColor = [254,202,202];
                }
                if (data.section === 'body' && data.column.index === 5) {
                    if (rows[data.row.index][5] === 'NO' || rows[data.row.index][5] === 'ILLAI')
                        data.cell.styles.fillColor = [224,231,255];
                }
            }
        });

        doc.save(`NFVT_Daily_Report_${loggedInUser.id}_${todayStr}.pdf`);
    }

    function downloadCSV() {
        const entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        const now = new Date();
        const pct = (n) => entries.length > 0 ? Math.round((n/entries.length)*100) : 0;
        const consistency = entries.filter(e => e.consistency === 'Yes').length;
        const meetingYes = entries.filter(e => e.meeting === 'Yes').length;
        const withJoiners = entries.filter(e => e.newJoiners === 'Yes').length;
        const active = entries.filter(e => e.selfPV >= 30).length;
        const hit100 = entries.filter(e => e.selfPV >= 100).length;

        let csv = `"NFVT Team Followup Report"\n"Generated: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}"\n"Report By: ${loggedInUser.name} (ID: ${loggedInUser.id})"\n\n`;
        csv += `"=== PERFORMANCE SUMMARY ==="\n`;
        csv += `"Parameter","Count","Percentage","Status"\n`;
        csv += `"Active IDs (PV>=30)","${active} of ${entries.length}","${pct(active)}%","${pct(active)>=80?'GOOD':pct(active)>=50?'AVERAGE':'NEEDS FOCUS'}"\n`;
        csv += `"Self PV >= 100","${hit100} of ${entries.length}","${pct(hit100)}%","${pct(hit100)>=80?'GOOD':pct(hit100)>=50?'AVERAGE':'NEEDS FOCUS'}"\n`;
        csv += `"100PV Consistency","${consistency} of ${entries.length}","${pct(consistency)}%","${pct(consistency)>=80?'GOOD':pct(consistency)>=50?'AVERAGE':'NEEDS FOCUS'}"\n`;
        csv += `"Meeting Attendance","${meetingYes} of ${entries.length}","${pct(meetingYes)}%","${pct(meetingYes)>=80?'GOOD':pct(meetingYes)>=50?'AVERAGE':'NEEDS FOCUS'}"\n`;
        csv += `"New Joiners","${withJoiners} of ${entries.length}","${pct(withJoiners)}%","${pct(withJoiners)>=80?'GOOD':pct(withJoiners)>=50?'AVERAGE':'NEEDS FOCUS'}"\n\n`;
        csv += `"=== MEMBER DATA ==="\n`;
        csv += "Name,ID,Mobile,Level,SelfPV,GroupPV,TotalPV,Date,100PV_CNC,Meeting,NewJoiners,Timestamp\n";
        entries.forEach(e => csv += `"${e.name}","${e.distId}","${e.mobile}","${e.level}","${e.selfPV}","${e.groupPV}","${e.totalPV}","${e.date}","${e.consistency}","${e.meeting}","${e.newJoiners||'No'}","${e.timestamp||''}"\n`);
        const b = new Blob([csv],{type:'text/csv'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download=`NFVT_Report_${loggedInUser.id}_${now.toISOString().split('T')[0]}.csv`; a.click();
    }

    function toggleTrash() {
        const ts = document.getElementById('trashSection');
        ts.style.display = (ts.style.display === 'none' || ts.style.display === '') ? 'block' : 'none';
        if(ts.style.display === 'block') {
            const trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
            document.getElementById('trashBody').innerHTML = trash.map(i => 
                `<tr style="background:white;">
                    <td><strong>${i.name}</strong></td><td>${i.distId}</td>
                    <td>
                        <button onclick="restoreEntry(${i.id})" style="background:#10b981;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:700;margin-right:5px;">‚Ü©Ô∏è ${currentLanguage==='en'?'Restore':'‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà'}</button>
                        <button onclick="permanentDelete(${i.id})" style="background:#7f1d1d;color:white;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-weight:700;">üóëÔ∏è ${currentLanguage==='en'?'Delete Forever':'‡Æ®‡Æø‡Æ∞‡Æ®‡Øç‡Æ§‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡ØÅ'}</button>
                    </td>
                </tr>`
            ).join('');
        }
    }

    function permanentDelete(id) {
        if(confirm(currentLanguage==='en'?"‚ö†Ô∏è PERMANENT DELETE!\n\nThis cannot be undone. Are you sure?":"‚ö†Ô∏è ‡Æ®‡Æø‡Æ∞‡Æ®‡Øç‡Æ§‡Æ∞ ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Æ≤‡Øç!\n\n‡Æâ‡Æ±‡ØÅ‡Æ§‡Æø‡ÆØ‡Ææ?")) {
            let trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
            const idx = trash.findIndex(e => e.id === id);
            if (idx > -1) { trash.splice(idx, 1); localStorage.setItem('nfvt_trash', JSON.stringify(trash)); toggleTrash(); setTimeout(()=>toggleTrash(),100); }
        }
    }

    function emptyTrash() {
        const trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
        if (trash.length === 0) { alert(currentLanguage==='en'?"Trash is empty!":"‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Øà ‡Æï‡Ææ‡Æ≤‡Æø‡ÆØ‡Ææ‡Æï!"); return; }
        if(confirm(currentLanguage==='en'?`‚ö†Ô∏è EMPTY TRASH!\n\nPermanently delete all ${trash.length} members?`:`‚ö†Ô∏è ${trash.length} ‡Æâ‡Æ±‡ØÅ‡Æ™‡Øç‡Æ™‡Æø‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡Øà ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡Æµ‡Ææ?`)) {
            localStorage.setItem('nfvt_trash', JSON.stringify([]));
            toggleTrash();
            alert(currentLanguage==='en'?"‚úÖ Trash emptied!":"‚úÖ ‡Æï‡ØÅ‡Æ™‡Øç‡Æ™‡Øà ‡Æï‡Ææ‡Æ≤‡Æø!");
        }
    }

    function restoreEntry(id) {
        let entries = JSON.parse(localStorage.getItem('nfvt_ucd_v2')) || [];
        let trash = JSON.parse(localStorage.getItem('nfvt_trash')) || [];
        const idx = trash.findIndex(e => e.id === id);
        if (idx > -1) {
            entries.unshift(trash[idx]);
            updateActivityLog('restore', trash[idx]);
            trash.splice(idx, 1);
            localStorage.setItem('nfvt_ucd_v2', JSON.stringify(entries));
            localStorage.setItem('nfvt_trash', JSON.stringify(trash));
            displayData(); toggleTrash(); setTimeout(()=>toggleTrash(),100);
        }
    }

    function filterTable() {
        const q = document.getElementById("searchInput").value.toUpperCase();
        const r = document.getElementById("tableBody").getElementsByTagName("tr");
        for (let row of r) { row.style.display = row.innerText.toUpperCase().includes(q) ? "" : "none"; }
    }
</script>
</body>
</html>
